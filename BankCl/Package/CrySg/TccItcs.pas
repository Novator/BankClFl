{******************************************************************}
{                                                                  }
{ Borland Delphi Runtime Library                                   }
{ Domen-K cryptographic interface unit                             }
{                                                                  }
{ 2003(fw) CB Transcapitalbank, Perm, Russia                       }
{ Written by Michael Galyuk, support@transcapbank.perm.ru          }
{                                                                  }
{ Software distributed under the License is distributed on an      }
{ "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or   }
{ implied.                                                         }
{                                                                  }
{  Œƒ –¿—œ–Œ—“–¿Õﬂ≈“—ﬂ œŒ œ–»Õ÷»œ” " ¿  ≈—“‹", Õ» ¿ »’             }
{ √¿–¿Õ“»… Õ≈ œ–≈ƒ”—Ã¿“–»¬¿≈“—ﬂ, ¬€ »—œŒÀ‹«”≈“≈ ≈√Œ Õ¿ —¬Œ… –»— .  }
{ ¿¬“Œ– Õ≈ Õ≈—≈“ Œ“¬≈“—“¬≈ÕÕŒ—“» «¿ œ–»◊»Õ≈ÕÕ€… ”Ÿ≈–¡ —¬ﬂ«¿ÕÕ€…    }
{ — ≈√Œ »—œŒÀ‹«Œ¬¿Õ»≈Ã (œ–¿¬»À‹Õ€Ã »À» Õ≈œ–¿¬»À‹Õ€Ã).              }
{                                                                  }
{******************************************************************}

unit TccItcs;

interface

uses
  Windows, SysUtils, CryptA, Classes, StrUtils;

const
  e_NO_ERROR               = 0;     // There was no error.
  e_NO_KEY_DISK_FOUND      = 1;     // Key diskette was not found.
  e_WRONG_PASSWORD         = 2;     // The entered password is not right.
  e_DIR_INACCESSIBLE       = 3;     // The directory is not accessible.
  e_FILE_NOT_FOUND         = 4;     // The specified file not found.
  e_FILE_READ_ERROR        = 5;     // Error  while reading file.
  e_FILE_WRITE_ERROR       = 6;     // Error while writing into file.
  e_DISTORTION             = 7;     // Decrypting or imito check detected distortion.
  e_DIR_NOT_FOUND          = 8;     // The directory was not found.
  e_LIMIT_PASSWORD         = 9;     // Invalid passwords are limited
  e_ENTER_PASS_REJECT     = 10;    // The user refused from entering password.
  e_NO_ENTER_PASS        = 11;    // The password was not entered.
  e_MESS_NOT_KVITTED     = 12;    // The specified message was not kvitted.  It is not an error.
  e_MESS_DELIVERED       = 13;    // The specified message was delivered to recipient. It is not an error.
  e_MESS_USED            = 14;    // The message was used (read, printed, etc.) by recipient. Not an error.
  e_UNMATCHED_KVIT       = 15;    // No registered sent message corresponding to received kvit.
  e_NO_MEM               = 16;    // Not enough memory.
  e_FILE_OPEN_ERROR      = 17;    // Error while opening file.
  e_INVALID_DIR          = 18;    // Directory can not have such name.
  e_FILE_INACCESSIBLE    = 19;    // Access to file denied.
  e_FILE_CLOSE_ERROR     = 20;    // Error while closing file.
  e_SEEK                 = 21;    // Error while positioning in file.
  e_WRONG_FILE_STRUCT    = 22;    // Wrong structure of structured file.
  e_WRONG_ABN_FILE_STRUCT= 23;    // Wrong structure of file *.abn.
  e_WRONG_APN_FILE_STRUCT= 24;    // Wrong structure of file *.apn.
  e_WRONG_GLUE_FILE_STRUCT =25;    // Wrong structure of glued file.
  e_SRV_ID_NOT_FOUND     = 26;    // The file nodename.doc not maintaining the server ID for given AP, but this ID must be present
  e_AP_ID_NOT_FOUND      = 27;    // The searching ID of the Abonent Point was not found
  e_INCORRECT_PARAMS     = 28;    // Function received incorrect parameters.
  e_INVALID_PASSWORD_LEN = 29;    // Password too long or too small.
  e_INVALID_ID_LEN       = 30;    // Identifier has wrong length.
  e_DIR_EMPTY            = 31;    // Directory is empty but it should not be such.
  e_KEY_NOT_FOUND        = 32;    // Desired key (of any type) was not found.
  e_ABN_ID_LEN           = 33;    // The specified length of the ID of abonent, that we need to make Key Disk, is wrong
  e_ABN_NAME_LEN         = 34;    // The specified length of the abonent name is wrong
  e_DISK_FULL            = 35;    // Not enough disk space.
  e_UNKNOWN_ERROR        = 36;    // The returned value does not correspond to any code.
  e_OUT_OF_RANGE         = 37;    // Index is beyond proper bounds.
  e_WRONG_ID_TYPE        = 38;    // function received identifier of not proper type.
  e_DIFF_ABN_IDENTS      = 39;    // The file NNNNAAAA.abn maintain the abonent ID, that differs from NNNNAAAA
  e_REPETION_OF_RAND     = 40;    // The random number has repeted.
  e_ATTR_ERROR           = 41;    // File's (dir's) attr. can't be received or set.
  e_INIT_NOT_MADE        = 42;    // Is used to turn off initialization of any kind or when creating an object without initialization.
  e_DELETE_FILE          = 43;    // Error while deleting file
  e_RENAME_FILE          = 44;    // Error while renaming file
  e_FILE_SIZE            = 45;    // Error while  get file size
  e_EMPTY_ABONENT        = 46;    // Count abonent is empty
  e_COMPRESS_ERROR       = 47;    // Error while process compressing
  e_DECOMPRESS_ERROR     = 48;    // Error while process decompressing
  e_NO_FLAG_INFOTECS     = 49;    // No flag infotecs ( ITCS )
  e_ERROR_COPY_STRING    = 50;    // Error while coping string
  e_FILE_INFO            = 51;    // Get file info ( date, time, attributes ...)
  e_FIND_FILE            = 52;    // Error while finding file
  e_FULL_PATH            = 53;    // Error can't get full path ( not file or other error )
  e_FILE_OFFSET          = 54;    // Error can't get offset in the file
  e_BAD_FILE_NAME        = 55;    // File name of envelope must be @*******.***; Receipt N|D|R******.***
  e_BAD_VERSION_ENVELOPE = 56;    // Bad version envelope
  e_NO_ENVELOPE          = 57;    // No Envelope
  e_BAD_KEY              = 58;    // Bad key
  e_BAD_HEADER_ENVELOPE  = 59;    // Bad header of envelope
  e_SET_WORK_DIR         = 60;    // Can't seting working directory
  e_CREATE_DIR           = 61;    // Error while creating directory
  e_DEL_DIR              = 62;    // Error while deleting directory
  e_ERROR_CREATE_FILE    = 63;    // Error while creating file
  e_COPY_FILE_ERROR      = 64;    // Error while coping  file.
  e_ABN_NOT_REGISTERED   = 65;    // The abonent is not registered at the given AP
  e_IS_NOT_PACKAGE             = 66; // This not package
  e_DOCUMENT_NOT_FOUND         = 67; // Document not found
  e_LIST_OF_DOCUMENT_IS_EMPTY  = 68; // Document list is empty
  e_FILE_UNPACK                = 69; // Can't unpack file
  e_FILE_PACK                  = 70; //  Can't file pack
  e_INVALID_HANDLE             = 71; // Invalid handle ( pointer to CKeyDisk )
  e_INVALID_CRYPTFILE_SIGNATURE= 72; // signature not equal 'CrYpT'
  e_UNKNOWN_CRYPT_METHOD       = 73; // only GOST crypting allowed
  e_FILE_CORRUPTED             = 74; // File is corrupted
  e_RECEIPT_TYPE_UNKNOWN       = 75; // Unknown type of receipt
  e_NO_RECEIPT                 = 76; // No receipt
  e_IS_ENVELOPE                = 77; // This envelope
  e_BAD_VERSION_RECEIPT        = 78; // Bad wersion receipt
  e_NOT_DEFINED_ADDRESS_RECEIVER = 79; // Denied adress receiver
  e_NOT_DEFINED_ADDRESS_SENDER = 80; // Denied adress sender
  e_LONG_NAME_DIR              = 81; // Is long name of directory
  e_WRONG_NUM_OF_PARAMS        = 82; // Exe-file receives wrong number of parameters.
  e_DB_CONTROL                 = 83;   // Error database
  e_DB_FULL                    = 84;   // Database is full
  e_DB_REC_NOT_FOUND           = 85;   // Record not found
  e_DOC_IS_REMOVE              = 86;   // Document was removed
  e_ADDR_SENDER                = 87;   // Invalid sender address
  e_ADDR_RECIEVER              = 88;   // Invalid receiver address
  e_ALREADY_PACKED             = 89;   // Document is already packed
  e_DOC_NOT_FOUND              = 90;   // Document not found
  e_PUT_HDR_ENV                = 91;   // Error header envelope writing
  e_GET_HDR_ENV                = 92;   // Error header envelope reading†
  e_DEL_HDR_ENV                = 93;   // Error header envelope removing
  e_SHIFR_FILE                 = 94;   // Encrypt file error†
  e_DESHIFR_FILE               = 95;   // Decrypt file error
  e_IMITO_FILE                 = 96;   // Imito file error
  e_ABONENT_NOT_FOUND          = 97;   // The specified abonent ID or Name is not found
  e_CHIEF_SIGN_NOT_VALID       = 98;   // The Sign of the Chief abonent in NNNN_spr.sgn is not valid
  e_ALREADY_SIGNED_BY_ABN      = 99;   // A file or memory already signed by specified abonent
  e_NO_TASK                   = 100;   // Envelope is assign for another task application
  e_RECEIVER_NOT_FOUND        = 101;   // The specified workgroup absent in address book
  e_DB_TABLE_OPEN             = 102;   // Error open DB Table
  e_DB_TABLE_READ             = 103;   // Error read table to list
  e_DB_TABLE_EDIT             = 104;   // Error update DB table record
  e_WRONG_OBJ_CMP_PARAMS      = 105;   // The parameters of objrcts to com-pare are not matched or wrong.
  e_UNSUITABLE_RIGHTS         = 106;   // The user rights are not suitable for some operation
  e_OVERDUE                   = 107;   // Some time period is overdue (or taken out from using )
  e_WRONG_OPERATION           = 108;   // Some operation is wrong
  e_BRANCH_NEXT_ELEM          = 109;   // Branch to next element
  e_FILE_READ_TREC            = 110;   // Error read special file
  e_PACKAGE_READ_HEADER       = 111;   // Read error package's header
  e_PACKAGE_READ_DOCUMENT     = 112;   // Read error package's document
  e_MASTERS_NOT_MATCH         = 113;   // The numbers of masters are not mathing
  e_NO_NET_MASTERS            = 114;   // No any net masters for generation
  e_NOT_IMPLEMENTED           = 115;   // Function not implemented
  e_FIND_FILE_COMPLETE        = 116;   // End of files searching
  e_INVALID_IMPLEMENTATION    = 117;   // Function not implemented in some case
  e_CUR_POS_FILE              = 118;   // CurPos () failed
  e_CHANGE_SIZE_FILE          = 119;   // Truncate () failed
  e_FLUSH_FILE                = 120;   // Flush () failed
  e_FILE_ALREADY_EXIST        = 121;   // File already exist
  e_SET_FILE_TIME             = 122;   // Set file time
  e_GET_FILE_TIME             = 123;   // Get file time
  e_FILE_MOVE_ERROR           = 124;   // File move error
  e_USE_GETLASTERROR          = 125;   // Use GetLastError
  e_GET_DISK_FREE_OR_TOTAL    = 126;   // Get disk free or total
  e_STREAM_END                = 127;   //end of stream was reached
  e_NEED_DICT                 = 128;   //preset dictionary needed
  e_ERRNO                     = 129;   //error occurred in the file system ,  you may consult errno    to get the exact error code.
  e_STREAM_ERROR              = 130;   //the stream state was inconsistent (for example  if next_in or next_out was NULL)
  e_DATA_ERROR                = 131;   //the input data was  corrupted
  e_BUF_ERROR                 = 132;   //no progress is possible or if there was not enough room in the output buffer
  e_VERSION_ERROR             = 133;   //the library version is incompatible with the   version assumed by the caller
  e_BAD_FILE_STRUCTURE        = 134;   //The file struct unexpected
  e_WRONG_NET_NUMBER          = 135;   //The network number is incorrect
  e_WRONG_VERSION             = 136;   //The version is incorrect
  e_WRONG_APP_TYPE            = 137;   //The task number is incorrect
  e_CHIEF_NOT_FOUND           = 138;   // The Chief abonent is not found in NNNN.chf
  e_WS_NOT_REGISTERED         = 139;   // The WS is not registered for this task
  e_DOCUMENT_NOT_SIGNED       = 140;   // The document not signed
  e_CHECK_SIGN                = 141;   // Error during checking sign
  e_NOT_INSTALLED             = 142;   // Something not installed
  e_ALREADY_DONE              = 143;   // Some operation already done.
  e_DRIVE_NOT_READY           = 144;   // Drive not ready
  e_COPYING_OLDER_FILES       = 145;   // Occuring in trying to copy the files with create time less then existing
  e_LOADLIBRARY               = 146;   // Error during LoadLibrary
  e_GETPROCADDRESS            = 147;   // Error during GetProcAddress
  e_ABORTED_BY_USER           = 148;   // An operation has been cancelled by user
  e_PREMATURE_OPERATION       = 149;   // The premature operation, Check Your system time, please.
  e_INCORRECT_SETTINGS        = 150;   // The settings are incorrect.
// ------ Added for the project of DirCrypt ------ 01.10.98
  e_CRYPTED_ANOTHER_SER         = 151; // Crypted another ser
  e_CRYPTED_THIS_SER_ANOTHER_PASS = 152; // Crypted this ser another pass
  e_CRYPTED_THIS_SER_THIS_PASS  = 153; // Crypted this ser this pass
  e_NO_CRYPTED                  = 154; // No crypted
  e_CRYPTED_ANOTHER_MODE        = 155; // Crypted another mode
// ----------------------------------------------------
  e_CAN_NOT_DO_OPERATION        = 156; // The operation can not be executed
  e_IDS_ARE_COINCIDE            = 157; // the IDs are coincide (the same or something else)
  e_IDS_ARE_NOT_COINCIDE        = 158; // the IDs are not coincide (different or something else)
  e_WAS_UNDO_OPERATION          = 159; // Not an error, but UNDO was encountered cause of the some error or the cancel be user
// ----------------------------------------------------
  e_ACK_BAD_STATUS              = 160;  // transport receipt has not allowed status
  e_DIFFERENT_IMITO_KEY         = 161;  // different imito key
  e_DIFFERENT_IMITO_HEADER      = 162;  // different imito header
  e_DEIMITO_FILE                = 163;  // deimito file error
  e_DISABLE                     = 164;  // Aplication disabled
  e_LOCKIPTRAFFIC               = 165;  // IP-traffic was locked
// ------ Added for the project of Aladdin ------ 26.10.2000
  e_ADR_CALLBACK_FUNCTION       = 170;  // Error address Callback Function
  e_INVALID_DEVICE_CODE         = 171;  // Invalid code of device
  e_ABORT_WAIT_CHECK_READY_DEVICE = 172;  // Aborted wait fo device
  e_CREATE_OBJECT_ALTERNATE_DEVICE = 173; // Error create object of device
  e_DRIVER_OR_DEVICE_NOT_INSTALLED = 174; // Driver or device not installed
  e_READING_INFO_DEVICE         = 175;  // Reading Mistake ID key
  e_WRONG_SLOT_OF_DEVICE        = 176;  // Wrong slot of device
  e_UNDEFINED_FUNCTION          = 177;  // Undefined function
  e_KEY_NOT_INSERTED_IN_DEVICE  = 178;  // Key not inserted in device
  e_READING_FROM_DEVICE         = 179;  // Error reading from device
  e_WRITING_TO_DEVICE           = 180;  // Error writing to device
  e_PARAM_LENTGH_READING_OR_WRITING = 181; // Error lentgh reading or writing
  e_CHIEF_SIGN_DATA             = 182;  // Error data of chief sign
  e_INVALID_FILE_NAME            = 183;  // Wrong file name
// { 19.03.2001
  e_REGOPENKEY                  = 184;   // Error during RegOpenKey
  e_REGQUERYVALUEEX             = 185;   // Error during RegQueryValueEx
  e_SWITCHDESKTOP               = 186;   // Error during SwitchDesktop
  e_SYSTEMPARAMETRSINFO         = 187;   // Error during SystemParametersInfo
  e_CREATEWINDOWEX              = 188;   // Error during CreateWindowEx
  e_LOCKERUI_BUSY               = 189;   // Unlock impossible - Locker Busy
  e_CREATEDESKTOP               = 190;   // Error during CreateDesktop
  e_CREATETHREAD                = 191;   // Error during CreateThread
// } 19.03.2001
// { 16.05.2001
  e_SIGN_NOT_ALLOWED            = 192;   // The user has no right to sign
// } 16.05.2001
  e_ABONENT_WAS_REMOVED         = 193;   // The user was removed from VPN
// { 04.09.2001
  e_NOT_FOUND                   = 194;   // Missing (arbitrary) object
  e_ALREADY_EXISTS              = 195;   // (Arbitrary) object already exists
// } 04.09.2001
// { 08.11.2001
  e_MISSING_ATTACHMENT          = 196;   // Missing attachment file
// } 08.11.2001
// { 27.12.2001
  e_MAIL_TOO_LARGE              = 197;   // Mail size is beyond message store size limit
// } 27.12.2001
  e_ALTERDEV_ERROR              = 198;   // Error in function of processing alternative devices data storage
  // 6.02.2002
  e_SAVE_TO_REG                 = 199;   //Save CSP defence  key to reg
  // 07.03.2002
  e_AP_CHIEF_SIGN_CREATION      = 200;   // The chief subscriber tryes to create the new digital signature on the AP
  e_NON_MAIN_AP_SIGN_CREATION   = 201;   // The subscriber tryes to create the new digital signature on the nonprime AP
  e_CERT_IS_NOT_VALID           = 202;   // A required certificate is not valid.
  e_CERT_E_EXPIRED              = 203;   // A required certificate is not within its validity period.
  // 25.04.2002 (for the version compatibility)
  e_SIGN_FORMAT_INCOMPATIBLE    = 204;   // The current user sign certificate is incompatible with the format of the signed file.

  // ŒÔÂ‰ÂÎÂÌËˇ Ï‡ÍÒËÏ‡Î¸Ì˚ı ‰ÎËÌ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡, ËÏÂÌË Ë ÔÒÂ‚‰ÓÌËÏ‡ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ
  _MAX_USER_ID_SIZE = 8;
  _MAX_USER_NAME_SIZE = 70;
  _MAX_USER_ALIAS_SIZE = 80;

  // ‘Î‡„Ë ËÌËˆË‡ÎËÁ‡ˆËË ÍËÔÚÓÔÓ‚‡È‰Â‡
  EXT_EXTERNAL_KEY_STORAGE = $00000001;     // ‘Î‡„ ‰Îˇ ÛÍ‡Á‡ÌËˇ ËÒÔÓÎ¸ÁÓ‚‡ÌËÂ ‚ÌÂ¯ÌËı ÒÂÚËÙËÍ‡ÚÓ‚
  EXT_SILENT_MODE = $00000002;     // ‘Î‡„ ‰Îˇ ÛÍ‡Á‡ÌËˇ ÂÊËÏ‡, ÌÂËÒÔÓÎ¸ÁÛ˛˘Â„Ó ËÌÚÂÙÂÈÒ Ò ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÏ.
  EXT_FORCE_SAVE_PASSWORD = $00000004;    // ‘Î‡„, ÍÓÚÓ˚È ÛÍ‡Á˚‚‡ÂÚ, ˜ÚÓ
    // ‚‚Â‰ÂÌÌ˚È Ô‡ÓÎ¸ ÌÂÓ·ıÓ‰ËÏÓ ÒÓı‡ÌËÚ¸ ‚ ÂÂÒÚÂ. ≈ÒÎË ˝ÚÓÚ ÙÎ‡„ ÌÂ ÛÍ‡Á‡Ì, ÚÓ
    // ‚ÓÁÏÓÊÌÓÒÚ¸ ÒÓı‡ÌËÚ¸ Ô‡ÓÎ¸ ·Û‰ÂÚ Á‡‚ËÒÂÚ¸ ÓÚ ÔÓÒÎÂ‰ÌÂÈ ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘ÂÈ Ì‡ÒÚÓÈÍË.
    // ƒ‡ÌÌ˚È ÙÎ‡„ Ë„ÌÓËÛÂÚÒˇ, ÂÒÎË ÛÒÚ‡ÌÓ‚ÎÂÌ Î˛·ÓÈ ËÁ ÒÎÂ‰Û˛˘Ëı ÙÎ‡„Ó‚:
    // EXT_EXTERNAL_KEY_STORAGE, EXT_SILENT_MODE

  // ‘Î‡„Ë ‰Îˇ ÛÍ‡Á‡ÌËˇ ÚËÔ‡ ‰‡ÌÌ˚ı ‰Îˇ ÙÛÌÍˆËÈ ÔÓ‰ÔËÒË / ¯ËÙÓ‚‡ÌËˇ
  EXT_FILE_DATA_FLAG = $00000001;    // ‘Î‡„ ‰Îˇ ÛÍ‡Á‡ÌËˇ Ù‡ÈÎ‡ ‚ Í‡˜ÂÒÚ‚Â ÚËÔ‡ ‰‡ÌÌ˚ı

  // ‘Î‡„Ë ‰Îˇ ÛÍ‡Á‡ÌËˇ ÓÒÓ·ÂÌÌÓÒÚÂÈ ‡·ÓÚ˚ ÔÓ‰ÔËÒË
  EXT_MULTIPLE_SIGN         = $00000001;    // ÃÌÓÊÂÒÚ‚ÂÌÌ‡ˇ ÔÓ‰ÔËÒ¸
  EXT_PKCS7_SIGN            = $00000002;    // œÓ‰ÔËÒ¸ ‚ ÙÓÏ‡ÚÂ PKCS7,
    // ˝ÚÓÚ ÙÎ‡„ ‡‚ÚÓÏ‡ÚË˜ÂÒÍË ËÒÔÓÎ¸ÁÛÂÚÒˇ, ÍÓ„‰‡ Á‡‰‡Ì EXT_EXTERNAL_KEY_STORAGE
    // ÔË ËÌËˆË‡ÎËÁ‡ˆËË ÔÓ‚‡È‰Â‡
  EXT_RETURN_CONTROL_INFO   = $00000010;    // ”Í‡Á˚‚‡ÂÚ, ˜ÚÓ ÌÂÓ·ıÓ‰ËÏÓ
    // ‚ÂÌÛÚ¸ ÍÓÌÚÓÎ¸ÌÛ˛ ËÌÙÓÏ‡ˆË˛ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË

  EXT_SMARTCARD_CONTAINER  = 'DEV|200|ITCS_SGN|'; // »Ïˇ ÍÓÌÚÂÈÌÂ‡  "ASE Card Reader"

  EXT_ETOKEN_CONTAINER    = 'DEV|300|ITCS_SGN|';  // »Ïˇ ÍÓÌÚÂÈÌÂ‡ E-token

  EXT_SCANTECH_CONTAINER   = 'DEV|600|ITCS_SGN|'; // »Ïˇ ÍÓÌÚÂÈÌÂ‡ ScanTech Reader

type
  // LPCALLBACK_ROUTINE - ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÚËÔ callback ÙÛÌÍˆËË, ÓÔÂ‰ÂÎˇÂÏÓÈ
  // Ì‡ ÔËÍÎ‡‰ÌÓÏ ÛÓ‚ÌÂ Ë ËÒÔÓÎ¸ÁÛÂÏÓÈ ÙÛÌÍˆËˇÏË EXT_Sign, EXT_VerifySign,
  // EXT_VerifyViewSignResult, EXT_Encrypt Ë EXT_Decrypt.
  // ‘ÛÌÍˆËˇ Ú‡ÍÓ„Ó ÚËÔ‡ ‚˚Á˚‚‡ÂÚÒˇ, ÍÓ„‰‡ Á‡Í‡Ì˜Ë‚‡ÂÚÒˇ Ó·‡·ÓÚÍ‡ Ó˜ÂÂ‰ÌÓÈ
  // ÔÓˆËË ‰‡ÌÌ˚ı. ≈ÒÎË ÙÛÌÍˆËˇ ‚ÓÁ‚‡˘‡ÂÚ FALSE, ÚÓ ÔÓˆÂÒÒ Ó·‡·ÓÚÍË
  // ËÌÙÓÏ‡ˆËË ÔÂÍ‡˘‡ÂÚÒˇ, ‡ ‚˚Á˚‚‡ÂÏ‡ˇ ÙÛÌÍˆËˇ (EXT_Sign, EXT_Encrypt (Ë.Ú.‰)
  // ‚ÂÌÂÚ ÍÓ‰ ‚ÓÁ‚‡Ú‡ e_ABORTED_BY_USER.
  LPCALLBACK_ROUTINE = function(TotalUnits: Int64; UnitsProcessed: Int64;
    lpCallBackData: Pointer): Boolean;

  // -------------------------------------------------------------------------
  // —ÚÛÍÚÛ‡ EXT_PATHNAMES ÔÂ‰Ì‡ÁÌ„‡˜ÂÌ‡ ‰Îˇ ÔÂÂ‰‡˜Ë ÏÂÒÚÓ‡ÒÔÓÎÓÊÂÌËˇ
  // ÍÎ˛˜Â‚ÓÈ ËÌÙÓÏ‡ˆËË
  //
  // ›ÎÂÏÂÌÚ                    ŒÔËÒ‡ÌËÂ
  // m_pszKeyDisketteDirectory    œÛÚ¸ Í Í‡Ú‡ÎÓ„Û Ò ÍÎ˛˜‡ÏË ‡·ÓÌÂÌÚ‡, Ì‡ÔËÏÂ,
  //                                 "A:" ËÎË "C:\VipNet"
  // m_pszTransportDirectory      œÛÚ¸ Í Í‡Ú‡ÎÓ„Û ÒÓ ÒÔ‡‚Ó˜ÌËÍ‡ÏË (Ú‡ÌÒÔÓÚÌ˚ÏË
  //                                 ÒÔ‡‚Ó˜ÌËÍ‡ÏË ¿·ÓÌÂÌÚÒÍÓ„Ó œÛÌÍÚ‡)
  // -------------------------------------------------------------------------
  EXT_PATHNAMES = packed record
    m_pszKeyDisketteDirectory: PChar;
    m_pszTransportDirectory: PChar;
  end;

  // -------------------------------------------------------------------------
  // —ÚÛÍÚÛ‡ EXT_FULL_CONTEXT ÔÂ‰Ì‡ÁÌ„‡˜ÂÌ‡ ‰Îˇ ÒÓÁ‰‡ÌËˇ ÍÓÌÚÂÍÒÚ‡
  // ÍËÔÚÓÔÓ‚‡È‰Â‡ Ë Ó·‡˘ÂÌËˇ ÔÓÒÂ‰ÒÚ‚ÓÏ Â„Ó Í ÍËÔÚÓ„‡ÙË˜ÂÒÍËÏ ÙÛÌÍˆËˇÏ
  // ›ÎÂÏÂÌÚ          ŒÔËÒ‡ÌËÂ
  // version          ¬ÌÛÚÂÌÌˇˇ ‚ÂÒËˇ — «» "ƒÓÏÂÌ- ". «‡ÂÁÂ‚ËÓ‚‡ÌÓ
  // hParent          ƒÂÒÍËÔÚÓ Ó‰ËÚÂÎ¸ÒÍÓ„Ó ÓÍÌ‡ (ÔËÍÎ‡‰ÌÓÈ ÔÓ„‡ÏÏ˚)
  // dwFlags          ‘Î‡„Ë, ÛÔ‡‚Îˇ˛˘ËÂ ‡·ÓÚÓÈ ÙÛÌÍˆËË ËÌËˆË‡ÎËÁ‡ˆËË.
  //                  «‡ÂÁÂ‚ËÓ‚‡ÌÓ. ƒÓÎÊÂÌ ·˚Ú¸ ‚˚ÒÚ‡‚ÎÂÌ ‚ 0;
  // pKeyStorage      ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_PATHNAMES, ÒÓ‰ÂÊ‡˘Û˛ ÔÛÚË
  //                  Í Í‡Ú‡ÎÓ„‡Ï Ò ÍÎ˛˜‡ÏË Ë ÒÔ‡‚Ó˜ÌËÍ‡ÏË
  // pProviderName    «‡ÂÁÂ‚ËÓ‚‡ÌÓ
  // pProviderError    Ó‰ (Ë/ËÎË ÒÓÓ·˘ÂÌËÂ) Ó¯Ë·ÍË ÌËÁÍÓÛÓ‚ÌÂ‚Ó„Ó
  //                  ÍËÔÚÓ„‡ÙË˜ÂÒÍÓ„Ó API
  // pCryptoProvider  ¬ÌÛÚÂÌÌˇˇ ÍËÔÚÓ„‡ÙË˜ÂÒÍ‡ˇ ÒÚÛÍÚÛ‡ ·Ë·ÎËÓÚÂÍË
  // -------------------------------------------------------------------------
  PEXT_FULL_CONTEXT = ^EXT_FULL_CONTEXT;
  EXT_FULL_CONTEXT = packed record
     Version: dWord;
     hParent: hWnd;
     dwFlags: dWord;
     pKeyStorage: PChar;
     pProviderName: PChar;
     pProviderError: PInteger;
     pCryptoProvider: Pointer;
  end;

  PEXT_CALLBACK_DATA = ^EXT_CALLBACK_DATA;
  EXT_CALLBACK_DATA = packed record
     lpCallBackRoutine: LPCALLBACK_ROUTINE;
     lpCallBackData: Pointer;
  end;

  // -------------------------------------------------------------------------
  // —ÚÛÍÚÛ‡ EXT_SIGN_RESULT ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ı‡ÌÂÌËˇ ÂÁÛÎ¸Ú‡Ú‡ ÔÓ‚ÂÍË
  // Ó‰ÌÓÈ ÔÓ‰ÔËÒË ÔÓ‰ ‰‡ÌÌ˚ÏË.
  //
  // ›ÎÂÏÂÌÚ               ŒÔËÒ‡ÌËÂ
  // CertResult            –ÂÁÛÎ¸Ú‡Ú ÔÓ‚ÂÍË ‰ÓÒÚÓ‚ÂÌÓÒÚË ÒÂÚËÙËÍ‡Ú‡
  // SignResult             –ÂÁÛÎ¸Ú‡Ú ÔÓ‚ÂÍË ÔÓ‰ÔËÒË ÔÓ‰ ‰‡ÌÌ˚ÏË
  //
  // -------------------------------------------------------------------------
  PEXT_SIGN_RESULT = ^EXT_SIGN_RESULT;
  EXT_SIGN_RESULT = packed record
    CertResult: dWord;
    SignResult: dWord;
  end;

  // -------------------------------------------------------------------------
  // —ÚÛÍÚÛ‡ EXT_SIGN_CONTEXT ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÒÓÁ‰‡ÌËˇ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //
  // ›ÎÂÏÂÌÚ               ŒÔËÒ‡ÌËÂ
  // pData                 ƒ‡ÌÌ˚Â ‰Îˇ ÔÓ‰ÔËÒË/ÔÓ‚ÂÍË ÔÓ‰ÔËÒË
  // DataLen                ÓÎË˜ÂÒÚ‚Ó ·‡ÈÚ ‰‡ÌÌ˚ı ‰Îˇ ÔÓ‰ÔËÒË/ÔÓ‚ÂÍË ÔÓ‰ÔËÒË
  // DataType              “ËÔ ‰‡ÌÌ˚ı, ÍÓÚÓ˚Â ÌÛÊÌÓ ÔÓ‰ÔËÒ‡Ú¸.
  //                       (Õ‡ÔËÏÂ, Ô‡ÏˇÚ¸ ËÎË Ù‡ÈÎ Ë Ú.‰.)
  // Flags                 ‘Î‡„Ë ‰Îˇ ‡·ÓÚ˚ ÙÛÌÍˆËÈ ÔÓ‰ÔËÒË/ÔÓ‚ÂÍË ÔÓ‰ÔËÒË 
  //                       (Á‡ÂÁÂ‚ËÓ‚‡ÌÓ)
  // pFunctionContext      ”Í‡Á‡ÚÂÎ¸ Ì‡ ÍÓÌÚÂÍÒÚ, ÓÔÂ‰ÂÎˇ˛˘ËÈ ÒÔÂˆËÙËÍÛ ‡·ÓÚ˚
  //                       ÙÛÌÍˆËÈ ÔÓ‰ÔËÒË, ÔÓ‚ÂÍË ÔÓ‰ÔËÒË. «‡ÂÁÂ‚ËÓ‚‡ÌÓ.
  //                       ƒÓÎÊÂÌ ·˚Ú¸ ‚˚ÒÚ‡‚ÎÂÌ ‚ NULL.
  // SignaturesNum          ÓÎË˜ÂÒÚ‚Ó ÔÓ‰ÔËÒÂÈ (Ì‡ ‰‡ÌÌ˚È ÏÓÏÂÌÚ
  //                       ‚ÒÂ„Ó Ó‰Ì‡ ÔÓ‰ÔËÒ¸). »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË,
  //                       ÔÓÎÛÂÌËË ËÌÙÓÏ‡ˆËË ÔÓ ÔÓ‰ÔËÒˇÏ.
  // pSignaturesData       ”Í‡Á‡ÚÂÎ¸ Ì‡ Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË, ÒÓ‰ÂÊ‡˘Û˛ ÂÁÛÎ¸Ú‡Ú 
  //                       ÔÓ‰ÔËÒË. »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‰ÔËÒË. ≈ÒÎË pSignaturesData
  //                       ÌÂ ‚˚ÒÚ‡‚ÎÂÌ ‚ NULL, Ò˜ËÚ‡ÂÚÒˇ, ˜ÚÓ ÔÓ ‰‡ÌÌÓÏÛ ‡‰ÂÒÛ
  //                       Ì‡ıÓ‰ËÚÒˇ ÒË„Ì‡ÚÛ‡ ÔÂ‰˚‰Û˘ÂÈ ÔÓ‰ÔËÒË, Ë ÌÂÓ·ıÓ‰ËÏÓ
  //                       ‰Ó·‡‚ËÚ¸ Â˘Â Ó‰ÌÛ. œË ˝ÚÓÏ Ô‡ÏˇÚ¸ ÔÓ ÛÍ‡Á‡ÌÌÓÏÛ ‡‰ÂÒÛ
  //                       ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ, ‡ ÌÓ‚‡ˇ - Á‡ı‚‡Ú˚‚‡ÂÚÒˇ.
  //                       ÕÂÓ·ıÓ‰ËÏÓ ‚˚ÒÚ‡‚ÎˇÚ¸ NULL, ÔÓÍ‡ ÌÂ Â‡ÎËÁÓ‚‡ÌÓ 
  //                       ÏÌÓÊÂÒÚ‚ÂÌÌÓÂ ÔÓ‰ÔËÒ˚‚‡ÌËÂ.
  // SignaturesDataLen     –‡ÁÏÂ Ó·Î‡ÒÚË Ô‡ÏˇÚË, ÒÓ‰ÂÊ‡˘ÂÈ
  //                       ÂÁÛÎ¸Ú‡Ú ÔÓ‰ÔËÒË. »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‰ÔËÒË.
  // pSignaturesResults   ”Í‡Á‡ÚÂÎ¸ Ì‡ Ï‡ÒÒË‚ Ò ÂÁÛÎ¸Ú‡Ú‡ÏË ÔÓ‰ÔËÒÂÈ.  ÓÎË˜ÂÒÚ‚Ó
  //                       ˝ÎÂÏÂÌÚÓ‚ Ï‡ÒÒË‚‡ = *pSignaturesNum.  ‡Ê‰˚È ˝ÎÂÏÂÌÚ
  //                       ÔÂ‰ÒÚ‡‚ÎˇÂÚ ÒÓ·ÓÈ ÒÚÛÍÚÛÛ EXT_SIGN_RESULT.
  //                       »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË Ë  ÔÓÒÏÓÚÂ 
  //                       ÂÁÛÎ¸Ú‡ÚÓ‚ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË.
  //                       œ‡ÏˇÚ¸ ‚˚‰ÂÎˇÂÚÒˇ ‚ÌÛÚË ÙÛÌÍˆËË ÔÓ‚ÂÍË ÔÓ‰ÔËÒË 
  //                       Ë Ó·ˇÁ‡Ì‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡ ÔËÍÎ‡‰ÌÓÈ ÔÓ„‡ÏÏÓÈ,
  //                       ÔÓÒÎÂ ÚÓ„Ó Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, 
  //                       Ò ÔÓÏÓ˘¸˛ ÙÛÌÍˆËË EXT_FreeMemory
  // ResultsSize           ƒÎËÌ‡ Ï‡ÒÒË‚‡ Ò ÂÁÛÎ¸Ú‡Ú‡ÏË ÔÓ‚ÂÍË 
  //                       ÔÓ‰ÔËÒÂÈ. »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË.
  // pControlInfo          ”Í‡Á‡ÚÂÎ¸ Ì‡ ‰ÓÔÓÎÌËÚÂÎ¸ÌÛ˛ ËÌÙÓÏ‡ˆË˛, ÍÓÚÓ‡ˇ
  //                       ÏÓÊÂÚ ÔÓÌ‡‰Ó·ËÚ¸Òˇ ‰Îˇ ÔÓÒÎÂ‰Û˛˘ÂÈ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË
  //                       (Ì‡ÔËÏÂ, HASH ÓÚ ÔÓ‰ÔËÒ‡ÌÌ˚ı ‰‡ÌÌ˚ı Ë Ú.Ô.).
  //                       ÔÓ‰ÔËÒÂÈ. ƒ‡ÌÌ˚È ÛÍ‡Á‡ÚÂÎ¸ ËÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‚ÂÍÂ
  //                       ÔÓ‰ÔËÒË Ë ÔÓÒÏÓÚÂ ÂÁÛÎ¸Ú‡ÚÓ‚ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË. 
  //                       œ‡ÏˇÚ¸ Á‡ı‚‡Ú˚‚‡ÂÚÒˇ ‚ÌÛÚË ÙÛÌÍˆËË. œ‡‡ÏÂÚ ˇ‚ÎˇÂÚÒˇ
  //                       ÌÂÓ·ˇÁ‡ÚÂÎ¸Ì˚Ï, ÔÓ˝ÚÓÏÛ, ÂÒÎË ‚˚Á˚‚‡˛˘‡ˇ ÙÛÌÍˆËˇ ÊÂÎ‡ÂÚ
  //                       ÔÓÎÛ˜‡Ú¸ ‰‡ÌÌÛ˛ ËÌÙÓÏ‡ˆË˛, ÌÂÓ·ıÓ‰ËÏÓ ÔË ÔÓ‚ÂÍÂ 
  //                       ÔÓ‰ÔËÒË (EXT_VerifySign) ÛÒÚ‡ÌÓ‚ËÚ¸ ·ËÚÓ‚˚È ÙÎ‡„ Flags
  //                       EXT_RETURN_CONTROL_INFO.
  // ControlInfoSize       –‡ÁÏÂ ‰ÓÔÓÎÌËÚÂÎ¸ÌÓÈ ËÌÙÓÏ‡ˆËË,
  //                       Ì‡È‰ÂÌÌÓÈ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË.
  //                       ÔÓ‰ÔËÒÂÈ. »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË Ë ÔÓÒÏÓÚÂ
  //                       ÂÁÛÎ¸Ú‡ÚÓ‚ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË.
  // -------------------------------------------------------------------------
  PEXT_SIGN_CONTEXT = ^EXT_SIGN_CONTEXT;
  EXT_SIGN_CONTEXT = packed record
    pData: Pointer;
    DataLen: dWord;
    DataType: dWord;
    Flags: dWord;
    pFunctionContext: Pointer;
    SignaturesNum: dWord;
    pSignaturesData: Pointer;
    SignaturesDataLen: dWord;
    pSignaturesResults: {array of EXT_SIGN_RESULT;}Pointer;
    ResultsSize: dWord;
    pControlInfo: Pointer;
    ControlInfoSize: dWord;
  end;

  // -------------------------------------------------------------------------
  // —ÚÛÍÚÛ‡ EXT_SIGNATURE_CONTEXT ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÒÓÁ‰‡ÌËˇ ÍÓÌÚÂÍÒÚ‡,
  // ÒÓ‰ÂÊ‡˘Â„Ó ‰‡ÌÌ˚Â ›÷œ
  //
  // ›ÎÂÏÂÌÚ          ŒÔËÒ‡ÌËÂ
  // pCertificate     ”Í‡Á‡ÚÂÎ¸ Ì‡ _CRYPTOAPI_BLOB, - ÒÚÛÍÚÛÛ,
  //                  ÒÓ‰ÂÊ‡˘Û˛ ÍÓ‰ËÓ‚‡ÌÌ˚È ÒÂÚËÙËÍ‡Ú;
  // CertificateLen   ƒÎËÌ‡ ‰‡ÌÌ˚ı, ÒÓ‰ÂÊ‡˘Ëı ÍÓ‰ËÓ‚‡ÌÌ˚È 
  //                  ÒÂÚËÙËÍ‡Ú;
  // pSignerInfo      ”Í‡Á‡ÚÂÎ¸ Ì‡ _CMSG_SIGNER_INFO, - ÒÚÛÍÚÛÛ, ÒÓ‰ÂÊ‡˘Û˛ 
  //                  ‰‡ÌÌ˚Â Ò ËÌÙÓÏ‡ˆËÂÈ Ó ÔÓ‰ÔËÒ‡‚¯ÂÏ ‡·ÓÌÂÌÚÂ;
  // SignerInfoLen    ƒÎËÌ‡ ‰‡ÌÌ˚ı, ÒÓ‰ÂÊ‡˘Ëı ËÌÙÓÏ‡ˆË˛ Ó 
  //                  ÔÓ‰ÔËÒ‡‚¯ÂÏ ‡·ÓÌÂÌÚÂ
  // -------------------------------------------------------------------------
  PEXT_SIGNATURE_CONTEXT = ^EXT_SIGNATURE_CONTEXT;
  EXT_SIGNATURE_CONTEXT = packed record
    pCertificate: Pointer;
    CertificateLen: dWord;
    pSignerInfo: Pointer;
    SignerInfoLen: dWord;
  end;

  // ---------------------------------------------------------------
  //                            EXT_CRYPT_DATA
  // ---------------------------------------------------------------
  // ›ÎÂÏÂÌÚ               ŒÔËÒ‡ÌËÂ
  //
  // pInputData            ¬ıÓ‰Ì˚Â ‰‡ÌÌ˚Â. œË ¯ËÙÓ‚‡ÌËË ˝ÚÓ plaintext,
  //                       ÔË ‡Ò¯ËÙÓ‚‡ÌËË - cryptotext.
  //                       ≈ÒÎË ÚËÔ ‰‡ÌÌ˚ı (DataType) - Ù‡ÈÎ, ÚÓ pInputData -
  //                       ËÏˇ ‚ıÓ‰ÌÓ„Ó Ù‡ÈÎ‡;
  // InputDataLen          –‡ÁÏÂ ‚ıÓ‰Ì˚ı ‰‡ÌÌ˚ı. ≈ÒÎË Á‡¯ËÙÓ‚˚‚‡ÂÚÒˇ
  //                       (‡Ò¯ËÙÓ‚˚‚‡ÂÚÒˇ) Ù‡ÈÎ, ÚÓ ÏÓÊÌÓ ÛÍ‡Á‡Ú¸ -1L, ÂÒÎË
  //                       ÌÂÓ·ıÓ‰ËÏÓ Á‡¯ËÙÓ‚‡Ú¸ Ù‡ÈÎ ÔÓÎÌÓÒÚ¸˛;
  // pOutputData           ¬˚ıÓ‰Ì˚Â ‰‡ÌÌ˚Â. œË ¯ËÙÓ‚‡ÌËË ˝ÚÓ cryptotext, 
  //                       ÔË ‡Ò¯ËÙÓ‚‡ÌËË - plaintext.
  //                       ≈ÒÎË ÚËÔ ‰‡ÌÌ˚ı (DataType) - Ù‡ÈÎ, ÚÓ pInputData - 
  //                       ËÏˇ ‚˚ıÓ‰ÌÓ„Ó Ù‡ÈÎ‡. »Ïˇ ‚˚ıÓ‰ÌÓ„Ó Ù‡ÈÎ‡ ÏÓÊÂÚ 
  //                       ÒÓ‚Ô‡‰‡Ú¸ Ò ËÏÂÌÂÏ ‚ıÓ‰ÌÓ„Ó Ù‡ÈÎ‡, ÚÓ„‰‡ ‚˚ıÓ‰ÌÓÈ 
  //                       Ù‡ÈÎ ·Û‰Ú ÔÂÂÁ‡ÔËÒ‡Ì ÔÓ‚Âı ‚ıÓ‰ÌÓ„Ó.
  //                       ≈ÒÎË ÚËÔ ‰‡ÌÌ˚ı (DataType) - Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË, ÚÓ
  //                       ÙÛÌÍˆËˇ Á‡¯ËÙÓ‚‡ÌËˇ/‡Ò¯ËÙÓ‚‡ÌËˇ ‚˚‰ÂÎËÚ Ô‡ÏˇÚ¸ ÔÓ‰
  //                       ‚˚ıÓ‰Ì˚Â ‰‡ÌÌ˚Â. œÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡Î‡ ÌÂÓ·ıÓ‰ËÏÓÒÚ¸
  //                       ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ô‡ÏˇÚ¸ ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡ 
  //                       ÙÛÌÍˆËÂÈ EXT_FreeMemory();
  // OutputDataLen         –‡ÁÏÂ ‚˚ıÓ‰Ì˚ı ‰‡ÌÌ˚ı. ¬ OutputDataLen ·Û‰ÂÚ ‚ÓÁ‚‡˘ÂÂÌ 
  //                       ‡ÁÏÂ ‚˚ıÓ‰ÌÓÈ ËÌÙÓÏ‡ˆËË ÔË Á‡¯ËÙÓ‚‡ÌËË/‡Ò¯ËÙÓ‚‡ÌËË
  //                       Ó·Î‡ÒÚË Ô‡ÏˇÚË.
  //                       ›ÚÓÚ ‡ÁÏÂ ÏÓÊÌÓ Ú‡ÍÊÂ ËÒÔÓÎ¸ÁÓ‚‡Ú¸ ÔË ÓÒ‚Ó·ÓÊ‰ÂÌËË 
  //                       Ô‡ÏˇÚË, ÍÓÚÓ‡ˇ ·˚Î‡ ‚˚‰ÂÎÂÌ‡ ‚ ÂÁÛÎ¸Ú‡ÚÂ ÓÚ‡·ÓÚÍË
  //                       ÙÛÌÍˆËË Á‡¯ËÙÓ‚‡ÌËˇ/‡Ò¯ËÙÓ‚‡ÌËˇ Ó·Î‡ÒÚË Ô‡ÏˇÚË.
  // DataType              “ËÔ Á‡¯ËÙÓ‚˚‚‡ÂÏ˚ı/‡Ò¯ËÙÓ‚˚‚‡ÂÏ˚ı ‰‡ÌÌ˚ı. 
  //                       ›ÚÓ ÏÓÊÂÚ ·˚Ú¸ Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË ËÎË Ù‡ÈÎ.
  // Flags                 ‘Î‡„Ë ¯ËÙÓ‚‡ÌËˇ. «‡ÂÁÂ‚ËÓ‚‡ÌÓ. œ‡‡ÏÂÚ ‰ÓÎÊÂÌ ·˚Ú¸ 
  //                       ‚˚ÒÚ‡‚ÎÂÌ ‚ 0UL;
  // pReceivers            œË ‡Ò¯ËÙÓ‚‡ÌËË ‰‡ÌÌ˚ı ˝ÚÓ "C-¯Ì‡ˇ" ÒÚÓÍ‡ Ò 
  //                       Ë‰ÂÌÚËÙËÍ‡ÚÓÓÏ ÔÓÎÛ˜‡ÚÂÎˇ, ‰Îˇ ÍÓÚÓÓ„Ó ÓÒÛ˘ÂÒÚ‚ÎˇÂÚÒˇ
  //                       ‡Ò¯ËÙÓ‚‡ÌËÂ.
  //                       œË ËÒÔÓÎ¸ÁÓ‚‡ÌËË ‚ ÙÛÌÍˆËˇı Á‡¯ËÙÓ‚‡ÌËˇ Ë ÔÓÎÛ˜ÂÌËˇ 
  //                       ÒÔËÒÍ‡ ÔÓÎÛ˜‡ÚÂÎÂÈ, ‰‡ÌÌ˚È Ô‡‡ÏÂÚ ˇ‚ÎˇÂÚÒˇ ÒÔËÒÍÓÏ
  //                       ÔÓÎÛ˜‡ÚÂÎÂÈ ‰Îˇ ÍÓÚÓ˚ı ·˚ÎË Á‡¯ËÙÓ‚‡Ì˚ ‰‡ÌÌ˚Â.
  //                       —ÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ ÔÂ‰ÒÚ‡‚ÎˇÂÚ ÒÓ·ÓÈ 
  //                       ÔÓÒÎÂ‰Ó‚‡ÚÂÎ¸ÌÓÒÚ¸ "C-¯Ì˚ı" ÒÚÓÍ, ‡Á‰ÂÎÂÌÌ˚ı '\0'. 
  //                       œÓÒÎÂ‰ÌËÈ ÔÓÎÛ˜‡ÚÂÎ¸ Á‡Í‡Ì˜Ë‚‡ÂÚÒˇ ‰‚ÛÏˇ '\0'.
  //                       œË ‚˚ÁÓ‚Â ÙÛÌÍˆËË ÔÓÎÛ˜ÂÌËË ÒÔËÒÍ‡ ÔÓÎÛ˜‡ÚÂÎÂÈ ÔÓ
  //                       ‰‡ÌÌÓÏÛ ‡‰ÂÒÛ ·Û‰ÂÚ ‚˚‰ÂÎÂÌ‡ Ô‡ÏˇÚ¸, Ë
  //                       ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡Î‡ ÌÂÓ·ıÓ‰ËÏÓÒÚ¸ ‚ ı‡ÌÂÌËË 
  //                       ‰‡ÌÌÓ„Ó ÒÔËÒÍ‡ Ô‡ÏˇÚ¸ ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡
  //                       ÙÛÌÍˆËÂÈ EXT_FreeMemory().
  // ReceiversBytesNum     –‡ÁÏÂ ÒÔËÒÍ‡ ÔÓÎÛ˜‡ÚÂÎÂÈ ‚ ·‡ÈÚ‡ı, ‚ÍÎ˛˜‡ˇ 
  //                       Á‡ÍÎ˛˜ËÚÂÎ¸Ì˚Â '\0''\0'. 
  //                       »ÒÔÓÎ¸ÁÛÂÚÒˇ ÔË ‚˚ÁÓ‚Â ÙÛÌÍˆËË ÔÓÎÛ˜ÂÌËˇ ÒÔËÒÍ‡
  //                       ÔÓÎÛ˜‡ÚÂÎÂÈ Á‡¯ËÙÓ‚‡ÌÌÓ„Ó Ù‡ÈÎ‡.
  //                       ›ÚÓÚ ‡ÁÏÂ ÏÓÊÌÓ ËÒÔÓÎ¸ÁÓ‚‡Ú¸ ÔË ÓÒ‚Ó·ÓÊ‰ÂÌËË Ô‡ÏˇÚË,
  //                       ÍÓÚÓ‡ˇ ·˚Î‡ ‚˚‰ÂÎÂÌ‡ ‚ ÂÁÛÎ¸Ú‡ÚÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË
  //                       ÔÓÎÛ˜ÂÌËˇ ÒÔËÒÍ‡ ÔÓÎÛ˜‡ÚÂÎÂÈ Á‡¯ËÙÓ‚‡ÌÌÓ„Ó Ù‡ÈÎ‡.
  // ---------------------------------------------------------------
  PEXT_CRYPT_CONTEXT = ^EXT_CRYPT_CONTEXT;
  EXT_CRYPT_CONTEXT = packed record
    pInputData: Pointer;
    InputDataLen: dWord;
    pOutputData: Pointer;
    OutputDataLen: dWord;
    DataType: dWord;
    Flags: dWord;
    pReceivers: PChar;
    ReceiversBytesNum: dWord;
  end;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_InitCrypt ÓÒÛ˘ÂÒÚ‚ÎˇÂÚ ÔÓ‚ÂÍÛ ‚‚Â‰ÂÌÌÓ„Ó Ô‡ÓÎˇ Ë ËÌËˆË‡ÎËÁ‡ˆË˛
  // ‡·ÓÚ˚ Ò ÍÎ˛˜‡ÏË ‡·ÓÌÂÌÚ‡. œÓÒÎÂ ˝ÚÓ„Ó ÓÒÛ˘ÂÒÚ‚ÎˇÂÚÒˇ ÔÓ‚ÂÍ‡ Ì‡ÎË˜Ëˇ
  // ÔË¯Â‰¯Ëı Ó·ÌÓ‚ÎÂÌËÈ ÍÎ˛˜ÂÈ, Ë, ÂÒÎË Ú‡ÍÓ‚˚Â ÓÍ‡Á‡ÎËÒ¸, ÔÓ‚Ó‰ËÚÒˇ Ó·ÌÓ‚ÎÂÌËÂ
  // ‰ÂÈÒÚ‚Û˛˘Ëı ÍÎ˛˜ÂÈ ‡·ÓÌÂÌÚ‡. ¬ÒÂ ÓÒÚ‡Î¸Ì˚Â ÙÛÌÍˆËË Ó·ˇÁ‡Ì˚ ‚˚Á˚‚‡Ú¸Òˇ ÚÓÎ¸ÍÓ
  // ÔÓÒÎÂ ÛÒÔÂ¯ÌÓ„Ó ‚˚ÁÓ‚‡ ‰‡ÌÌÓÈ ÙÛÌÍˆËË. ƒÎˇ ÓÍÓÌ˜‡ÌËˇ ‡·ÓÚ˚ Ò ÙÛÌÍˆËˇÏË — «» 
  // ÌÂÓ·ıÓ‰ËÏÓ ‚˚Á‚‡Ú¸ ÙÛÌÍˆË˛ EXT_CloseCrypt.
  //
  // ƒÎˇ ËÌËˆË‡ÎËÁ‡ˆËË Ú‡ÍÊÂ ÏÓÊÌÓ ‚ÓÒÔÓÎ¸ÁÓ‚‡Ú¸Òˇ ÙÛÌÍˆËÂÈ 
  // EXT_InitCryptEx (ÒÏ. ÌËÊÂ).
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ                   ŒÔËÒ‡ÌËÂ
  // psPassword                 œ‡ÓÎ¸ ‡·ÓÌÂÌÚ‡
  // PasswordLen                ƒÎËÌ‡ Ô‡ÓÎˇ ‡·ÓÌÂÌÚ‡
  // pContext                   ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  //
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // psPassword
  // PasswordLen
  // pContext->pKeyStorage
  //                            pContext->pCryptoProvider
  //                            pContext->pProvderError
  //
  // -------------------------------------------------------------------------
  TExtInitCrypt = function(psPassword: PChar; PasswordLen: Integer;
    pContext: PEXT_FULL_CONTEXT): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_InitCryptEx ÓÒÛ˘ÂÒÚ‚ÎˇÂÚ ‚‚Ó‰ Ô‡ÓÎˇ Ë Ó·ÌÓ‚ÎÂÌËÂ ÍÎ˛˜ÂÈ.
  // ƒ‡ÌÌ‡ˇ ÙÛÌÍˆËˇ ËÌÚÂ‡ÍÚË‚ÌÓ Á‡Ô‡¯Ë‚‡ÂÚ Ô‡ÓÎ¸ ‡·ÓÌÂÌÚ‡, Ë ÔÓÒÎÂ ÛÒÔÂ¯ÌÓÈ
  // ÔÓ‚ÂÍË ÓÒÛ˘ÂÒÚ‚Îˇ˛ÚÒˇ ÔÓ‚ÂÍ‡ Ì‡ÎË˜Ëˇ ÔË¯Â‰¯Ëı Ó·ÌÓ‚ÎÂÌËÈ ÍÎ˛˜ÂÈ Ë
  // (ÂÒÎË Ú‡ÍÓ‚˚Â ÓÍ‡Á‡ÎËÒ¸) Ó·ÌÓ‚ÎÂÌËÂ ‰ÂÈÒÚ‚Û˛˘Ëı ÍÎ˛˜ÂÈ ‡·ÓÌÂÌÚ‡.
  // ƒ‡ÌÌ‡ˇ ÙÛÌÍˆËˇ ÔÓÁ‚ÓÎˇÂÚ ÓÒÛ˘ÂÒÚ‚ËÚ¸ ‚‚Ó‰ Ô‡ÓÎˇ Ò ÍÎ‡‚Ë‡ÚÛ˚ ËÎË Ò
  // ‚ÌÂ¯ÌËı ˝ÎÂÍÚÓÌÌ˚ı ÌÓÒËÚÂÎÂÈ.
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ                   ŒÔËÒ‡ÌËÂ
  // pContext                   ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pKeyStorage 
  //                            pContext->pCryptoProvider
  //                            pContext->pProviderError
  //
  // œËÏÂ˜‡ÌËÂ: pContext->pKeyStorage - ÌÂÓ·ˇÁ‡ÚÂÎ¸Ì˚È Ô‡‡ÏÂÚ.
  // «‡‰‡ÂÚÒˇ, ÂÒÎË ÌÛÊÌ˚ ÍÎ˛˜Ë, Ì‡ıÓ‰ˇ˘ËÂÒˇ ÌÂ ‚ ÒÚ‡Ì‰‡ÚÌÓÏ ‰Îˇ »“ — Í‡Ú‡ÎÓ„Â
  // -------------------------------------------------------------------------
  TExtInitCryptEx = function(pContext: PEXT_FULL_CONTEXT): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_CloseCrypt ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ Á‡Í˚ÚËˇ ÔÂ‰‚‡ËÚÂÎ¸ÌÓ ‚˚‰ÂÎÂÌÌÓ„Ó
  // ÍËÔÚÓ„‡ÙË˜ÂÒÍÓ„Ó ÍÓÌÚÂÍÒÚ‡. ŒÌ‡ ‰ÓÎÊÌ‡ ‚˚Á˚‚‡Ú¸Òˇ ÌÂÔÓÒÂ‰ÒÚ‚ÂÌÌÓ ÔÂÂ‰ 
  // Á‡‚Â¯ÂÌËÂÏ ‡·ÓÚ˚ Ò ·Ë·ÎËÓÚÂÍÓÈ. œÓÒÎÂ ‚˚ÁÓ‚‡ ‰‡ÌÌÓÈ ÙÛÌÍˆËË ‰Îˇ 
  // ‚ÓÁÓ·ÌÓ‚ÎÂÌËˇ ‡·ÓÚ˚ Ò — «» ÌÂÓ·ıÓ‰ËÏÓ ÒÌÓ‚‡ ‚˚Á‚‡Ú¸ ÙÛÌÍˆË˛ 
  // EXT_InitCrypt ËÎË EXT_InitCryptEx.
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÔÂ‰‚‡ËÚÂÎ¸ÌÓ ‚˚‰ÂÎÂÌÌ˚È ÍÓÌÚÂÍÒÚ 
  //                       ·Ë·ÎËÓÚÂÍË
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ      ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext
  // -------------------------------------------------------------------------
  TExtCloseCrypt = procedure(pContext: PEXT_FULL_CONTEXT); stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_FreeMemory ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÓÒ‚Ó·ÓÊ‰ÂÌËˇ Ô‡ÏˇÚË, ‚˚‰ÂÎÂÌÌÓÈ
  // ÙÛÌÍˆËˇÏË ·Ë·ÎËÓÚÂÍË "ƒÓÏÂÌ- ".
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pData                 ”Í‡Á‡ÚÂÎ¸ Ì‡ ÓÒ‚Ó·ÓÊ‰‡ÂÏÛ˛ Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË
  // DataLen               ƒÎËÌ‡ ÓÒ‚Ó·ÓÊ‰‡ÂÏÓ„Ó ·ÛÙÂ‡. ≈ÒÎË ÛÍ‡Á‡Ì‡, ÚÓ
  //                       ÔÂÂ‰ ÓÒ‚Ó·ÓÊ‰ÂÌËÂÏ Ô‡ÏˇÚË ÛÍ‡Á‡ÌÌÓÂ ÍÓÎË˜ÂÒÚ‚Ó ·‡ÈÚ
  //                       ·Û‰ÂÚ Á‡ÔÓÎÌÂÌÓ ÌÛÎˇÏË. ≈ÒÎË Ô‡‡ÏÂÚ ‡‚ÂÌ ÌÛÎ˛,
  //                       Ô‡ÏˇÚ¸ ÔÓÒÚÓ ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ ÔÓ ÛÍ‡Á‡ÚÂÎ˛ ‚ pData.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ      ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pData
  // DataLen
  // -------------------------------------------------------------------------
  TExtFreeMemory = function(pData: Pointer; DataLen: dWord): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_AllocMemory ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ Á‡ı‚‡Ú‡ Ô‡ÏˇÚË. ƒ‡ÌÌ‡ˇ ÙÛÌÍˆËˇ
  // ÏÓÊÂÚ ÔÓÌ‡‰Ó·ËÚ¸Òˇ ÔË ËÒÔÓÎ¸ÁÓ‚‡ÌËË ÏÌÓÊÌÒÚ‚ÂÌÌÓ„Ó ÔÓ‰ÔËÒ˚‚‡ÌËˇ,
  // ‡ÁÌÂÒÂÌÌÓ„Ó ‚Ó ‚ÂÏÂÌË. Õ‡ÔËÏÂ, ÔÓÏÂÊÛÚÓ˜Ì˚È ÂÁÛÎ¸Ú‡Ú ÔÓ‰ÔËÒË ÏÓÊÂÚ 
  // ·˚Ú¸ ÒÓı‡ÌÂÌ ‚ Ù‡ÈÎÂ, ‡ Á‡ÚÂÏ Ò˜ËÚ‡Ì ‚ ‚˚‰ÂÎÂÌÌÛ˛ ‰‡ÌÌÓÈ ÙÛÌÍˆËÂÈ Ô‡ÏˇÚ¸
  // Ë ÔÂÂ‰‡Ì ‚ ÙÛyÍˆË˛ ÔÓ‰ÔËÒË (EXT_Sign Í‡Í Ô‡‡ÏÂÚ pSignaturesData 
  // ÒÚÛÍÚÛ˚ EXT_SIGN_CONTEXT). 
  // ≈ÒÎË Ô‡ÏˇÚ¸ ‚˚‰ÂÎËÎ‡Ò¸, ‚ÓÁ‚‡ÚËÚÒˇ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ‚˚‰ÂÎÂÌÌÛ˛ Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË,
  // ‚ ÔÓÚË‚ÌÓÏ ÒÎÛ˜‡Â ‚ÂÌÂÚÒˇ NULL.
  // œ‡ÏˇÚ¸, ‚˚‰ÂÎÂÌÌ‡ˇ ‰‡ÌÌÓÈ ÙÛÌÍˆËÂÈ, ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡ ÙÛÌÍˆËÂÈ
  // EXT_FreeMemory.
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // DataLen               ƒÎËÌ‡ ‚˚‰ÂÎˇÂÏÓ„Ó ·ÛÙÂ‡
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ      ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // DataLen
  // -------------------------------------------------------------------------
  TExtAllocMemory = function(DataLen: dWord): Pointer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_GetErrorDefinition ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ ÒÏ˚ÒÎÓ‚ÓÈ
  // ËÌÙÓÏ‡ˆËË Ó· Ó¯Ë·ÍÂ. ‘ÛÌÍˆËˇ ÌÂ ‚˚‰ÂÎˇÂÚ Ô‡ÏˇÚ¸. ŒÌ‡ ‚ÓÁ‚‡˘‡ÂÚ ËÌÙÓÏ‡ˆË˛
  // Ó ÍÓ‰Â Ó˘Ë·ÍË ‚ ‚˚‰ÂÎÂÌÌÛ˛ ‚ÌÂ¯ÌÂÈ ÙÛÌÍˆËÂÈ Ô‡ÏˇÚ¸.
  //
  // ≈ÒÎË ÛÍ‡Á‡ÚÂÎ¸ pErrDefinition ‚˚ÒÚ‡‚ÎÂÌ ‚ NULL, ÚÓ ÙÛÌÍˆËˇ ‚˚˜ËÒÎËÚ 
  // ‡ÁÏÂ Ô‡ÏˇÚË, ÍÓÚÓ˚È ÂÈ ÌÂÓ·ıÓ‰ËÏ ‰Îˇ ‡ÁÏÂ˘ÂÌËˇ ÓÔËÒ‡ÌËˇ ÍÓ‰‡ Ó¯Ë·ÍË, 
  // ‚ÍÎ˛˜‡ˇ '\0', Ë ‚ÂÌÂÚ ˝ÚÓÚ ‡ÁÏÂ ‚ Ô‡‡ÏÂÚÂ pErrDefSize;
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // ErrCode                Ó‰ Ó¯Ë·ÍË ÔÂËÓ‰‡ ‡·ÓÚ˚ — «»
  // pErrDefinition        ”Í‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ ‰Îˇ ÒÓÓ·˘ÂÌËˇ
  // pErrDefSize           ”Í‡Á‡ÚÂÎ¸ Ì‡ ‰ÎËÌÛ ·ÛÙÂ‡
  // -------------------------------------------------------------------------
  TExtGetErrorDefinition = procedure(const ErrCode: Integer;
    pErrDefinition: PChar; var pErrDefSize: dWord); stdcall;

  TExtRetCode2WinErr = function(RetCode: Integer): dWord; stdcall;

  TExtRetCode2HResult = function(RetCode: Integer): HResult; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓÎÛ˜ÂÌËˇ ÒÓ·ÒÚ‚ÂÌÌÓ„Ó Ë‰ÂÌÚËÙËÍ‡ÚÓ‡ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ
  //
  // œËÏÂÌˇÂÚÒˇ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡ ‰ÂÈÒÚ‚Û˛˘Â„Ó
  // ‚ ‰‡ÌÌ˚È ÏÓÏÂÌÚ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. 
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pszUserID             ”Í‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ Á‡ÔËÒ‡Ì 
  //                       Ë‰ÂÌÚËÙËÍ‡ÚÓ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. –‡ÁÏÂ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡
  //                       Ó„‡ÌË˜ÂÌ ‚ÓÒ¸Ï¸˛ ÒËÏ‚ÓÎ‡ÏË, ÔÓ˝ÚÓÏÛ ÔËÍÎ‡‰Ì‡ˇ ÔÓ„‡ÏÏ‡ 
  //                       ‰ÓÎÊÌ‡ ÔÂÂ‰‡Ú¸ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ ‡ÁÏÂÓÏ ‚ 8 + 1 ÒËÏ‚ÓÎ 
  //                       (Ó‰ËÌ - ‰Îˇ '\0'). ≈ÒÎË Ô‡‡ÏÂÚ ‡‚ÂÌ NULL,
  //                       ÚÓ Ë‰ÂÌÚËÙËÍ‡ÚÓ ÌÂ ‚ÓÁ‚‡˘‡ÂÚÒˇ.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext
  // pszUserID                  pszUserID
  //                            pContext->pProviderError
  // -------------------------------------------------------------------------
  TExtGetOwnID = function(pContext: PEXT_FULL_CONTEXT; pszUserID: PChar): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓÎÛ˜ÂÌËˇ ÒÔËÒÍ‡ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ ‚ÒÂı ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ
  //
  // œÓÒÎÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË EXT_GetUserIDList Ô‡‡ÏÂÚ ppszUserIDList
  // ·Û‰ÂÚ ÒÓ‰ÂÊ‡Ú¸ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ Á‡Â„ËÒÚËÓ‚‡ÌÌ˚ı
  // ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ. Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË, Ì‡ ÍÓÚÓÛ˛ ÛÍ‡Á˚‚‡ÂÚ ppszUserIDList
  // ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡ ‚˚Á˚‚‡˛˘ÂÈ ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ
  // Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛ ÙÛÌÍˆËË EXT_FreeMemory.
  // œÓÒÎÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË EXT_GetUserIDList Ô‡‡ÏÂÚ ppszUserIDList ·Û‰ÂÚ
  // ÒÓ‰ÂÊ‡Ú¸ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ Á‡Â„ËÒÚËÓ‚‡ÌÌ˚ı ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ.
  // ‘ÓÏ‡Ú ÒÔËÒÍ‡ ÔÓÎÛ˜‡ÚÂÎÂÈ ÒÏ. ‚ ÓÔËÒ‡ÌËË ÒÚÛÍÚÛ˚ EXT_CRYPT_CONTEXT.
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË, Ì‡ ÍÓÚÓÛ˛ ÛÍ‡Á˚‚‡ÂÚ ppszUserIDList ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡
  // ‚˚Á˚‚‡˛˘ÂÈ ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı,
  // Ò ÔÓÏÓ˘¸˛ ÙÛÌÍˆËË EXT_FreeMemory.
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // ppszUserIDList        ”Í‡Á‡ÚÂÎ¸ Ì‡ ÛÍ‡Á‡ÚÂÎ¸, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ ‚ÓÁ‚‡˘ÂÌ
  //                       ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ Á‡Â„ËÒÚËÓ‚‡ÌÌ˚ı ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ.
  //                       ‘ÓÏ‡Ú ÒÔËÒÍ‡ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ ÒÏ. ‚ ÓÔËÒ‡ÌËË ÒÚÛÍÚÛ˚
  //                       EXT_CRYPT_CONTEXT.
  // pUserIDListSize       ”Í‡Á‡ÚÂÎ¸ Ì‡ ÔÂÂÏÂÌÌÛ˛, ‚ ÍÓÚÓÛ˛ ·Û‰ÂÚ ‚ÓÁ‚‡˘ÂÌ ‡ÁÏÂ
  //                       Ô‡ÏˇÚË, ‚˚‰ÂÎÂÌÌ˚È ÔÓ‰ ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚
  //                       ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ. ÃÓÊÂÚ ·˚Ú¸ ÔÂÂ‰‡Ì NULL, ÂÒÎË ÌÂ ÌÛÊÌÓ
  //                       ‚ÓÁ‚‡˘‡Ú¸ ÍÓÎË˜ÂÒÚ‚Ó ‚˚‰ÂÎÂÌÌÓÈ Ô‡ÏˇÚË. œ‡‡ÏÂÚ ÏÓÊÂÚ
  //                       ·˚Ú¸ ËÒÔÓÎ¸ÁÓ‚‡Ì ÔË ÓÒ‚Ó·ÓÊ‰ÂÌËË Ô‡ÏˇÚË ÔË ÔÂÂ‰‡˜Â
  //                       ‚ ÙÛÌÍˆË˛ EXT_FreeMemory
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext
  // ppszUserIDList             ppszUserIDList
  // pUserIDListSize            pUserIDListSize
  //                            pContext->pProviderError
  // -------------------------------------------------------------------------
  TExtGetUserIDList = function(pContext: PEXT_FULL_CONTEXT;
    var ppszUserIDList: PChar; var pUserIDListSize: Integer): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓÎÛ˜ÂÌËˇ ÔÒÂ‚‰ÓÌËÏ‡ Ë ËÏÂÌË ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ ÔÓ Â„Ó Ë‰ÂÌÚËÙËÍ‡ÚÓÛ
  //
  // ‘ÛÌÍˆËˇ ÔËÏÂÌˇÂÚÒˇ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ ÔÒÂ‚‰ÓÌËÏ‡ (Ë/ËÎË ËÏÂÌË) ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ.
  // Œ·˚˜ÌÓ ËÒÔÓÎ¸ÁÛÂÚÒˇ ÔÓÒÎÂ ‚˚ÁÓ‚‡ ÙÛÌÍˆËË EXT_GetReceivers, ÍÓÚÓ‡ˇ ‚ÓÁ‚‡˘‡ÂÚ
  // ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ.
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pszUserID             ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÓÍÛ, ÒÓ‰ÂÊ‡˘Û˛ Ë‰ÂÌÚËÙËÍ‡ÚÓ
  //                       ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ;
  // pszUserAlias          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÛÍ‡Á‡ÚÂÎ¸, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ Á‡ÔËÒ‡Ì
  //                       ÔÒÂ‚‰ÓÌËÏ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. –‡ÁÏÂ ÔÒÂ‚‰ÓÌËÏ‡ Ó„‡ÌË˜ÂÌ 
  //                       ‚ÓÒ¸Ï¸˛‰ÂÒˇÚ¸˛ ÒËÏ‚ÓÎ‡ÏË, ÔÓ˝ÚÓÏÛ ÔËÍÎ‡‰Ì‡ˇ ÔÓ„‡ÏÏ‡
  //                       ‰ÓÎÊÌ‡ ÔÂÂ‰‡Ú¸ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ ‡ÁÏÂÓÏ ‚
  //                       80 + 1 ÒËÏ‚ÓÎ (Ó‰ËÌ - ‰Îˇ '\0').
  //                       ≈ÒÎË Ô‡‡ÏÂÚ ‡‚ÂÌ NULL, ÚÓ ÔÒÂ‚‰ÓÌËÏ ÌÂ ‚ÓÁ‚‡˘‡ÂÚÒˇ.
  // pszUserName           ”Í‡Á‡ÚÂÎ¸ Ì‡ ÛÍ‡Á‡ÚÂÎ¸, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ Á‡ÔËÒ‡ÌÓ ËÏˇ 
  //                       ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. –‡ÁÏÂ ËÏÂÌË Ó„‡ÌË˜ÂÌ ÒÂÏ¸˛‰ÂÒˇÚ¸˛
  //                       ÒËÏ‚ÓÎ‡ÏË, ÔÓ˝ÚÓÏÛ ÔËÍÎ‡‰Ì‡ˇ ÔÓ„‡ÏÏ‡ ‰ÓÎÊÌ‡ ÔÂÂ‰‡Ú¸ 
  //                       ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ ‡ÁÏÂÓÏ ‚ 70 + 1 ÒËÏ‚ÓÎ 
  //                       (Ó‰ËÌ - ‰Îˇ '\0'). ≈ÒÎË Ô‡‡ÏÂÚ ‡‚ÂÌ NULL,
  //                       ÚÓ ËÏˇ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ ÌÂ ‚ÓÁ‚‡˘‡ÂÚÒˇ.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  //
  // pContext
  // pszUserID
  // pszUserAlias               pszUserAlias
  // pszUserName                pszUserName
  //                            pContext->pProviderError
  // -------------------------------------------------------------------------
  TExtGetUserAlias = function(pContext: PEXT_FULL_CONTEXT; const pszUserID: PChar;
    pszUserAlias: PChar; pszUserName: PChar): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓÎÛ˜ÂÌËˇ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡ Ë ËÏÂÌË ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ ÔÓ Â„Ó ÔÒÂ‚‰ÓÌËÏÛ
  //
  // ‘ÛÌÍˆËˇ EXT_GetUserID ÔËÏÂÌˇÂÚÒˇ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡ (Ë/ËÎË ËÏÂÌË) 
  // ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. Œ·˚˜ÌÓ ËÒÔÓÎ¸ÁÛÂÚÒˇ ÔÓÒÎÂ ‚˚ÁÓ‚‡ ÙÛÌÍˆËÈ EXT_Encrypt,
  // EXT_Decrypt, ÍÓÚÓ˚Â ÚÂ·Û˛Ú Ì‡ ‚ıÓ‰ Ë‰ÂÌÚËÙËÍ‡ÚÓ˚ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ.
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  //
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pszUserAlias          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÓÍÛ, ÒÓ‰ÂÊ‡˘Û˛ ÔÒÂ‚‰ÓÌËÏ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ;
  // pszUserID             ”Í‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ Á‡ÔËÒ‡Ì 
  //                       Ë‰ÂÌÚËÙËÍ‡ÚÓ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. –‡ÁÏÂ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡
  //                       Ó„‡ÌË˜ÂÌ ‚ÓÒ¸Ï¸˛ ÒËÏ‚ÓÎ‡ÏË, ÔÓ˝ÚÓÏÛ ÔËÍÎ‡‰Ì‡ˇ ÔÓ„‡ÏÏ‡
  //                       ‰ÓÎÊÌ‡ ÔÂÂ‰‡Ú¸ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ ‡ÁÏÂÓÏ
  //                       ‚ 8 + 1 ÒËÏ‚ÓÎ (Ó‰ËÌ - ‰Îˇ '\0'). 
  //                       ≈ÒÎË Ô‡‡ÏÂÚ ‡‚ÂÌ NULL, ÚÓ Ë‰ÂÌÚËÙËÍ‡ÚÓ ÌÂ ‚ÓÁ‚‡˘‡ÂÚÒˇ.
  // ppszUserName          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÛÍ‡Á‡ÚÂÎ¸, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ Á‡ÔËÒ‡ÌÓ ËÏˇ
  //                       ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ. –‡ÁÏÂ ËÏÂÌË Ó„‡ÌË˜ÂÌ ÒÂÏ¸˛‰ÂÒˇÚ¸˛ 
  //                       ÒËÏ‚ÓÎ‡ÏË, ÔÓ˝ÚÓÏÛ ÔËÍÎ‡‰Ì‡ˇ ÔÓ„‡ÏÏ‡ ‰ÓÎÊÌ‡ ÔÂÂ‰‡Ú¸ 
  //                       ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ·ÛÙÂ ‡ÁÏÂÓÏ ‚ 70 + 1 ÒËÏ‚ÓÎ
  //                       (Ó‰ËÌ - ‰Îˇ '\0'). 
  //                       ≈ÒÎË Ô‡‡ÏÂÚ ‡‚ÂÌ NULL, ÚÓ ËÏˇ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ
  //                       ÌÂ ‚ÓÁ‚‡˘‡ÂÚÒˇ.
  // 
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  //
  // pContext
  // pszUserAlias
  // pszUserID                  pszUserID
  // pszUserName                pszUserName
  //                            pContext->pProviderError
  // -------------------------------------------------------------------------
  TExtGetUserID = function(pContext: PEXT_FULL_CONTEXT;
    const pszUserAlias: PChar; pszUserID: PChar; pszUserName: PChar): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓ‰ÔËÒË Ô‡ÏˇÚË/Ù‡ÈÎ‡
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pSignContext          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //                       EXT_SIGN_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            pData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÔÓ‰ÔËÒ˚‚‡ÂÏ˚Â ‰‡ÌÌ˚Â
  //                            DataLen   = ‰ÎËÌ‡ ÔÓ‰ÔËÒ˚‚‡ÂÏ˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı
  //                            DataType  = “ËÔ ‰‡ÌÌ˚ı (Ô‡ÏˇÚ¸ / Ù‡ÈÎ)
  //                            Flags     = 0
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pSignContext->pData
  // pSignContext->DataLen
  // pSignContext->DataType
  // pSignContext->Flags
  //                                 pSignContext->pSignaturesData
  //                                 pSignContext->OutSignaturesDataLen
  //                                 pContext->pProviderError
  //
  // œÓÒÎÂ ‚˚ÁÓ‚‡ ÙÛÌÍˆËË pSignContext->pSignaturesData ·Û‰ÂÚ ÒÓ‰ÂÊ‡Ú¸ ÔÓ‰ÔËÒ¸
  // ÔÓ‰ ‰‡ÌÌ˚ÏË, ‡ pSignContext->OutSignaturesDataLen - ‰ÎËÌÛ ÔÓ‰ÔËÒË ‚ ·‡ÈÚ‡ı.
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË pSignContext->pSignaturesData ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ ‚˚Á˚‚‡˛˘ÂÈ
  // ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛
  // ÙÛÌÍˆËË EXT_FreeMemory.

  // œËÏÂ˜‡ÌËÂ: Œ‰ÌÓ‚ÂÏÂÌÌÓÈ ÔÓ‰ÔËÒË Ù‡ÈÎ‡ Ë Ô‡ÏˇÚË ÌÂ ÔÓËÁ‚Ó‰ËÚÒˇ.
  // -------------------------------------------------------------------------
  TExtSign = function(pContext: PEXT_FULL_CONTEXT;
    pSignContext: PEXT_SIGN_CONTEXT; pCallBackData: PEXT_CALLBACK_DATA): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_VerifySign ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË ÔÓ‰ 
  // Ô‡ÏˇÚ¸˛ / Ù‡ÈÎÓÏ.
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ         ŒÔËÒ‡ÌËÂ
  // pContext         ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // œË ËÒÔÓÎ¸ÁÓ‚‡ÌËË ÙÓÏ‡Ú‡ PKCS#7 ˝ÚÓÚ Ô‡‡ÏÂÚ ÏÓÊÂÚ ·˚Ú¸ NULL
  //
  // pSignContext     ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË 
  //                  EXT_SIGN_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡ 
  //                  ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                       pData               = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÔÓ‰ÔËÒ‡ÌÌ˚Â ‰‡ÌÌ˚Â
  //                       DataLen             = ‰ÎËÌ‡ ÔÓ‰ÔËÒ‡ÌÌ˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı
  //                       DataType                 = “ËÔ ‰‡ÌÌ˚ı (Ô‡ÏˇÚ¸ / Ù‡ÈÎ)
  //                       Flags               = 0
  //                       pSignaturesData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ›÷œ
  //                       SignaturesDataLen   = ƒÎËÌ‡ ›÷œ
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                     ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider    
  // pSignContext->pData  
  // pSignContext->DataLen        
  // pSignContext->DataType
  // pSignContext->Flags
  // pSignContext->pSignaturesData        pSignContext->pSignaturesData
  // pSignContext->SignaturesDataLen      pSignContext->SignaturesDataLen
  //                                      pSignContext->SignaturesNum
  //                                      pSignContext->pSignaturesResults
  //                                      pSignContext->ResultsSize
  //                                      pSignContext->pControlInfo
  //                                      pSignContext->ControlInfoSize
  //                                      pContext->pProviderError
  //
  // œÓÒÎÂ ‚˚ÁÓ‚‡ ÙÛÌÍˆËË Ô‡‡ÏÂÚ pSignContext->SignaturesNum ·Û‰ÂÚ ÒÓ‰ÂÊ‡Ú¸
  // ÍÓÎË˜ÂÒÚ‚Ó ÔÓ‰ÔËÒÂÈ (Ó‰ÌÛ), ‡ pSignContext->pSignaturesResults - ÛÍ‡Á‡ÚÂÎ¸
  // Ì‡ Ï‡ÒÒË‚ ÒÚÛÍÚÛ EXT_SIGN_RESULT, ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘ËÈ ÂÁÛÎ¸Ú‡Ú‡Ï ÔÓ‚ÂÍË
  // ÔÓ‰ÔËÒË.
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË pSignContext->pSignaturesResults ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ ‚˚Á˚‚‡˛˘ÂÈ
  // ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛ 
  // ÙÛÌÍˆËË EXT_FreeMemory.
  //
  // œËÏÂ˜‡ÌËÂ: Œ‰ÌÓ‚ÂÏÂÌÌÓÈ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË Ù‡ÈÎ‡ Ë Ô‡ÏˇÚË ÌÂ ÔÓËÁ‚Ó‰ËÚÒˇ.
  // ------------------------------------------------------------------------- 
  TExtVerifySign = function(pContext: PEXT_FULL_CONTEXT;
    pSignContext: PEXT_SIGN_CONTEXT; pCallBackData: PEXT_CALLBACK_DATA): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_GetSignInfo ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ ËÌÙÓÏ‡ˆËË
  // ÔÓ ÔÓ‰ÔËÒË. ƒ‡ÌÌ‡ˇ ÙÛÌÍˆËˇ ‡Á·Ë‡ÂÚ ‰‡ÌÌ˚Â, ÔÓÎÛ˜ÂÌÌ˚Â ÔË ÔÓ‰ÔËÒË 
  // ‰ÓÍÛÏÂÌÚ‡, Ë ‚ÓÁ‚‡˘‡ÂÚ ËÌÙÓÏ‡ˆË˛, ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘Û˛ ÒÂÚËÙËÍ‡ÚÛ ÔÓ‰ÔËÒË,
  // Ë ËÌÙÓÏ‡ˆË˛ Ó ÔÓ‰ÔËÒ‡‚¯ÂÏ ‡·ÓÌÂÌÚÂ. ƒÎˇ Û‰Ó·ÒÚ‚‡ ËÒÔÓÎ¸ÁÓ‚‡ÌËˇ ˝ÚË 
  // ‰‡ÌÌ˚Â ‚ÓÁ‚‡˘‡˛ÚÒˇ ‚ ÙÓÏ‡Ú‡ı, ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘Ëı ÒÚÛÍÚÛ‡Ï Microsoft
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pSignContext          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //                       EXT_SIGN_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡ 
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            Flags               = 0
  //                            pSignaturesData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ›÷œ
  //                            SignaturesDataLen   = ƒÎËÌ‡ ›÷œ
  //                            SignaturesNum       = »Ì‰ÂÍÒ ÔÓ‰ÔËÒË, ‰Îˇ ÍÓÚÓÓÈ 
  //                            ÌÛÊÌÓ ÔÓÎÛ˜ËÚ¸ ËÌÙÓÏ‡ˆË˛ (‰ÓÎÊÂÌ ÛÍ‡Á˚‚‡Ú¸ Ì‡ Â‰ËÌËˆÛ).
  // pSignatureContext     ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÒË„Ì‡ÚÛ˚ ÔÓ‰ÔËÒË
  //                       EXT_SIGNATURE_CONTEXT
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                     ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pSignContext->Flags
  // pSignContext->pSignaturesData    
  // pSignContext->SignaturesDataLen
  // pSignContext->SignaturesNum
  //                                      pSignatureContext->pCertificate
  //                                      pSignatureContext->CertificateLen
  //                                      pSignatureContext->pSignerInfo
  //                                      pSignatureContext->SignerInfoLen
  //                                      pContext->pProviderError
  //
  // œÓÒÎÂ ‚˚ÁÓ‚‡ ÙÛÌÍˆËË pSignatureContext->pCertificate ÒÓ‰ÂÊËÚ ÛÍ‡Á‡ÚÂÎ¸
  // Ì‡ ÍÓ‰ËÓ‚‡ÌÌ˚È ÒÂÚËÙËÍ‡Ú, pSignatureContext->CertificateLen ÒÓ‰ÂÊËÚ ˜ËÒÎÓ 
  // ·‡ÈÚ, Á‡ÌËÏ‡ÂÏ˚ı ÍÓ‰ËÓ‚‡ÌÌ˚Ï ÒÂÚËÙËÍ‡ÚÓÏ;
  // pSignatureContext->pSignerInfo ÒÓ‰ÂÊËÚ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÍÓ‰ËÓ‚‡ÌÌÛ˛ ËÌÙÓÏ‡ˆË˛
  // Ó ÔÓ‰ÔËÒ‡‚¯ÂÏ ‡·ÓÌÂÌÚÂ, pSignatureContext->SignerInfoLen ÒÓ‰ÂÊËÚ ˜ËÒÎÓ
  // ·‡ÈÚ, Á‡ÌËÏ‡ÂÏ˚ı ËÌÙÓÏ‡ˆËÂÈ Ó ÔÓ‰ÔËÒ‡‚¯ÂÏ ‡·ÓÌÂÌÚÂ. 
  //
  // Œ·Î‡ÒÚË Ô‡ÏˇÚË pSignatureContext->pCertificate Ë pSignatureContext->pSignerInfo 
  // ‰ÓÎÊÌ˚ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ˚ ‚˚Á˚‚‡˛˘ÂÈ ÙÛÌÍˆËÂÈ
  // ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛ 
  // ÙÛÌÍˆËË EXT_FreeMemory.
  // -------------------------------------------------------------------------
  TExtGetSignInfo = function (pContext: PEXT_FULL_CONTEXT;
    pSignContext: PEXT_SIGN_CONTEXT; pSignatureContext: PEXT_SIGNATURE_CONTEXT): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_VerifyViewSignResult ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓ‚ÂÍË Ë ÔÓÒÏÓÚ‡ 
  // ÂÁÛÎ¸Ú‡Ú‡ ÔÓ‰ÔËÒË ÔÓ‰ ‰‡ÌÌ˚ÏË (‡ Ú‡ÍÊÂ ‰Îˇ ÔÓÒÏÓÚ‡ ÒÂÚËÙËÍ‡Ú‡ 
  // ÔÓ‰ÔËÒ‡‚¯Â„Ó  ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ). ÃÓÊÌÓ ‚ÓÒÔÓÎ¸ÁÓ‚‡Ú¸Òˇ Ú‡ÍÊÂ ËÌÚÂ‡ÍÚË‚ÌÓÈ 
  // ÙÛÌÍˆËÂÈ EXT_ViewSignResult, ÍÓÚÓ‡ˇ Ú‡ÍÊÂ ÓÚÓ·‡Ê‡ÂÚ ÓÍÌÓ Ò 
  // ÂÁÛÎ¸Ú‡Ú‡ÏË ÔÓ‚ÂÍË ÔÓ‰ÔËÒË ÔÓ‰ ‰‡ÌÌ˚ÏË Ë ÒÂÚËÙËÍ‡Ú‡ ÔÓ‰ÔËÒ‡‚¯Â„Ó, 
  // ÌÓ ‚ ÓÚÎË˜ËÂ ÓÚ ‰‡ÌÌÓÈ, ÌÂ ÔÓ‚ÂˇÂÚ ÔÓ‰ÔËÒ¸, ‡ ÎË¯¸ ËÒÔÓÎ¸ÁÛÂÚ ‰‡ÌÌ˚Â,
  // ÔÓÎÛ˜ÂÌÌ˚Â ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË (EXT_VerifySign).
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pSignContext          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË 
  //                       EXT_SIGN_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡ 
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            Flags               = 0
  //                            pSignaturesData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ›÷œ
  //                            SignaturesDataLen   = ƒÎËÌ‡ ›÷œ
  //                            pTitleStr           = —ÚÓÍ‡, ÒÓ‰ÂÊ‡˘‡ˇ Í‡ÍÓÂ-ÎË·Ó Ì‡Á‚‡ÌËÂ 
  //                                                  ÔÓ‰ÔËÒ‡ÌÌ˚ı ‰‡ÌÌ˚ı;
  //                                                  ÃÓÊÂÚ ÓÚÒÛÚÒÚ‚Ó‚‡Ú¸, ÚÓ ÂÒÚ¸ pTitleStr ÏÓÊÂÚ 
  //                                                  ·˚Ú¸ ‡‚Ì˚Ï ÌÛÎ˛.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                     ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pContext->hParent
  // pSignContext->Flags
  // pSignContext->pSignaturesData
  // pSignContext->SignaturesDataLen
  // pTitleStr
  // ------------------------------------------------------------------------- 
  TExtVerifyViewSignResult = function(pContext: PEXT_FULL_CONTEXT;
    pSignContext: PEXT_SIGN_CONTEXT; const pTitleStr: PChar;
    pCallBackData: PEXT_CALLBACK_DATA): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ EXT_ViewSignResult ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓÒÏÓÚ‡
  // ÂÁÛÎ¸Ú‡Ú‡ ÔÓ‰ÔËÒË ÔÓ‰ ‰‡ÌÌ˚ÏË (‡ Ú‡ÍÊÂ ‰Îˇ ÔÓÒÏÓÚ‡ ÒÂÚËÙËÍ‡Ú‡
  // ÔÓ‰ÔËÒ‡‚¯Â„Ó  ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ). ÕÂ ÔÓ‚ÂˇÂÚ ÔÓ‰ÔËÒ¸, ‡ ÎË¯¸ ËÒÔÓÎ¸ÁÛÂÚ ‰‡ÌÌ˚Â,
  // ÔÓÎÛ˜ÂÌÌ˚Â ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË (EXT_VerifySign).
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pSignContext          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //                       EXT_SIGN_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            Flags               = 0
  //                            pSignaturesData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ›÷œ
  //                            SignaturesDataLen   = ƒÎËÌ‡ ›÷œ
  //                            pSignaturesResults        = ”Í‡Á‡ÚÂÎ¸ Ì‡ Ï‡ÒÒË‚ Ò ÂÁÛÎ¸Ú‡Ú‡ÏË ÔÓ‰ÔËÒÂÈ.
  //                            ResultsSize         = ƒÎËÌ‡ Ï‡ÒÒË‚‡ Ò ÂÁÛÎ¸Ú‡Ú‡ÏË ÔÓ‚ÂÍË 
  //                                                  ÔÓ‰ÔËÒÂÈ.
  //                            pControlInfo        = ”Í‡Á‡ÚÂÎ¸ Ì‡ ‰ÓÔÓÎÌËÚÂÎ¸ÌÛ˛ ËÌÙÓÏ‡ˆË˛, 
  //                                                  ÍÓÚÓ‡ˇ ËÒÔÓÎ¸ÁÛÂÚÒˇ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË
  //                            ControlInfoSize     = –‡ÁÏÂ ‰ÓÔÓÎÌËÚÂÎ¸ÌÓÈ ËÌÙÓÏ‡ˆËË, 
  //                                                  Ì‡È‰ÂÌÌÓÈ ÔË ÔÓ‚ÂÍÂ ÔÓ‰ÔËÒË.
  //                            pTitleStr           = —ÚÓÍ‡, ÒÓ‰ÂÊ‡˘‡ˇ Í‡ÍÓÂ-ÎË·Ó Ì‡Á‚‡ÌËÂ
  //                                                  ÔÓ‰ÔËÒ‡ÌÌ˚ı ‰‡ÌÌ˚ı;
  //                                                  ÃÓÊÂÚ ÓÚÒÛÚÒÚ‚Ó‚‡Ú¸, ÚÓ ÂÒÚ¸ pTitleStr ÏÓÊÂÚ 
  //                                                  ·˚Ú¸ ‡‚Ì˚Ï ÌÛÎ˛.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                     ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pContext->hParent
  // pSignContext->Flags
  // pSignContext->pSignaturesData
  // pSignContext->SignaturesDataLen
  // pSignContext->pSignaturesResults
  // pSignContext->ResultsSize
  // pSignContext->pControlInfo
  // pSignContext->ControlInfoSize
  // pTitleStr
  // -------------------------------------------------------------------------
  TExtViewSignResult = function(pContext: PEXT_FULL_CONTEXT;
    pSignContext: PEXT_SIGN_CONTEXT; const pTitleStr: PChar): Integer; stdcall;

  TExtGetSignatureSize = function(pContext: PEXT_FULL_CONTEXT;
    pSignContext: PEXT_SIGN_CONTEXT; var pSignatureSize: Integer): Integer; stdcall;

  TExtGetCurrentCertificate = function(pContext: PEXT_FULL_CONTEXT;
    var ppEncodedCertificate: Pointer; var pEncodedCertSize: Integer): Integer; stdcall;

  TExtViewEncodedCertificate = function(pContext: PEXT_FULL_CONTEXT;
    const pEncodedCertificate: Pointer; EncodedCertSize: Integer): Integer; stdcall;

  TExtViewCertificate = function(pContext: PEXT_FULL_CONTEXT;
    const pCertContext: PCERT_CONTEXT): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ Á‡¯ËÙÓ‚‡ÌËˇ Ô‡ÏˇÚË/Ù‡ÈÎ‡
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pCryptContext         ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //                       EXT_CRYPT_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            pInputData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ Á‡¯ËÙÓ‚˚‚‡ÂÏ˚Â ‰‡ÌÌ˚Â
  //                            InputDataLen   = ‰ÎËÌ‡ ËÒıÓ‰Ì˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı.
  //                                           ƒÎˇ Ù‡ÈÎ‡ ‰‡ÌÌ˚È Ô‡‡ÏÂÚ ÌÂ ËÏÂÂÚ
  //                                           ÁÌ‡˜ÂÌËˇ, Ú‡Í Í‡Í ‡ÁÏÂ Ù‡ÈÎ‡ ·Û‰ÂÚ 
  //                                           ‚˚˜ËÒÎÂÌ ‚ÌÛÚË ÙÛÌÍˆËË;
  //                            DataType       = “ËÔ ‰‡ÌÌ˚ı (Ô‡ÏˇÚ¸ / Ù‡ÈÎ)
  //                            Flags          = 0
  //                            pOutputData    = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ËÏˇ ‚˚ıÓ‰ÌÓ„Ó Ù‡ÈÎ‡,
  //                                           ÂÒÎË ÓÒÛ˘ÂÒÚ‚ÎˇÂÚÒˇ Á‡¯ËÙÓ‚‡ÌËÂ
  //                                           Ù‡ÈÎ‡, ËÌ‡˜Â ‰ÓÎÊÂÌ ·˚Ú¸ ‚˚ÒÚ‡‚ÎÂÌ
  //                                           ‚ NULL.
  //                            pReceivers     = ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÔËÒÓÍ ÔÓÎÛ˜‡ÚÂÎÂÈ,
  //                                           ‰Îˇ ÍÓÚÓ˚ı ÌÂÓ·ıÓ‰ËÏÓ Á‡¯ËÙÓ‚‡Ú¸
  //                                           ‰‡ÌÌ˚Â. ‘ÓÏ‡Ú ÒÔËÒÍ‡ ÒÏ. ‚ ÓÔËÒ‡ÌËË
  //                                           ÒÚÛÍÚÛ˚ EXT_CRYPT_CONTEXT;
  // pCallBackContext      ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_CALLBACK_DATA, ÍÓÚÓ‡ˇ ÔÓÁ‚ÓÎˇÂÚ
  //                       ÔËÍÎ‡‰ÌÓÈ ÔÓ„‡ÏÏÂ ÔÂËÓ‰Ë˜ÂÒÍË ÔÓÎÛ˜‡Ú¸ ÛÔ‡‚ÎÂÌËÂ ÔË
  //                       ‰ÓÎ„Ó‚ÂÏÂÌÌ˚ı ÓÔÂ‡ˆËˇı ‰Îˇ ÓÚÓ·‡ÊÂÌËˇ ÔÓ„ÂÒÒ‡ ÓÔÂ‡ˆËË.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pCryptContext->pInputData
  // pCryptContext->InputDataLen
  // pCryptContext->DataType
  // pCryptContext->Flags
  // pCryptContext->pOutputData      pCryptContext->pOutputData
  //                                 pCryptContext->OutputDataLen
  //                                 pContext->pProviderError
  //
  // ≈ÒÎË Á‡¯ËÙÓ‚˚‚‡ÎË Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË, ÚÓ ÔÓÒÎÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË 
  // pCryptContext->pOutputData ·Û‰ÂÚ ÒÓ‰ÂÊ‡Ú¸ ÒÓ‚ÓÍÛÔÌÓÒÚ¸
  // Á‡¯ËÙÓ‚‡ÌÌ˚ı ‰‡ÌÌ˚ı Ë ÍËÔÚÓËÌÙÓÏ‡ˆËË ‰Îˇ ‡Ò¯ËÙÓ‚‡ÌËˇ,
  // pCryptContext->OutputDataLen - ‰ÎËÌÛ ‚˚ıÓ‰Ì˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı,  
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË pCryptContext->pOutputData ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ ‚˚Á˚‚‡˛˘ÂÈ
  // ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛
  // ÙÛÌÍˆËË EXT_FreeMemory.
  // ≈ÒÎË Á‡¯ËÙÓ‚˚‚‡ÎË Ù‡ÈÎ, ÚÓ pCryptContext->pOutputData ˇ‚ÎˇÂÚÒˇ ‚ıÓ‰Ì˚Ï
  // Ô‡‡ÏÂÚÓÏ, ‡ pCryptContext->OutputDataLen ÌÂ ËÒÔÓÎ¸ÁÛÂÚÒˇ. –ÂÁÛÎ¸Ú‡ÚÓÏ 
  // ‡·ÓÚ˚ ÙÛÌÍˆËË ‚ ‰‡ÌÌÓÏ ÒÎÛ˜‡Â ˇ‚ÎˇÂÚÒˇ Á‡¯ËÙÓ‚‡ÌÌ˚È Ù‡ÈÎ, ËÏˇ ÍÓÚÓÓ„Ó
  // ·˚ÎÓ ÔÂÂ‰‡ÌÓ ÙÛÌÍˆËË ‚ Ô‡‡ÏÂÚÂ pCryptContext->pOutputData.
  // -------------------------------------------------------------------------
  TExtEncrypt = function(pContext: PEXT_FULL_CONTEXT;
    pCryptContext: PEXT_CRYPT_CONTEXT; pCallBackData: PEXT_CALLBACK_DATA): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ‡Ò¯ËÙÓ‚‡ÌËˇ Ô‡ÏˇÚË/Ù‡ÈÎ‡
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pCryptContext         ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //                       EXT_CRYPT_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            pInputData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ Á‡¯ËÙÓ‚‡ÌÌ˚Â ‰‡ÌÌ˚Â
  //                            InputDataLen   = ‰ÎËÌ‡ Á‡¯ËÙÓ‚‡ÌÌ˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı.
  //                                           ƒÎˇ Ù‡ÈÎ‡ ‰‡ÌÌ˚È Ô‡‡ÏÂÚ ÌÂ ËÏÂÂÚ
  //                                           ÁÌ‡˜ÂÌËˇ, Ú‡Í Í‡Í ‡ÁÏÂ Ù‡ÈÎ‡ ·Û‰ÂÚ
  //                                           ‚˚˜ËÒÎÂÌ ‚ÌÛÚË ÙÛÌÍˆËË;
  //                            DataType       = “ËÔ ‰‡ÌÌ˚ı (Ô‡ÏˇÚ¸ / Ù‡ÈÎ)
  //                            Flags          = 0
  //                            pOutputData    = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ËÏˇ ‚˚ıÓ‰ÌÓ„Ó Ù‡ÈÎ‡,
  //                                           ÂÒÎË ÓÒÛ˘ÂÒÚ‚ÎˇÂÚÒˇ Á‡¯ËÙÓ‚‡ÌËÂ
  //                                           Ù‡ÈÎ‡, ËÌ‡˜Â ‰ÓÎÊÂÌ ·˚Ú¸ ‚˚ÒÚ‡‚ÎÂÌ
  //                                           ‚ NULL.
  //                            pReceivers     = ”Í‡Á‡ÚÂÎ¸ Ì‡ ÔÓÎÛ˜‡ÚÂÎˇ,
  //                                           ‰Îˇ ÍÓÚÓÓ„Ó Á‡¯ËÙÓ‚˚‚‡ÎËÒ¸ ‰‡ÌÌ˚Â.
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pCryptContext->pInputData
  // pCryptContext->InputDataLen
  // pCryptContext->DataType
  // pCryptContext->Flags
  // pCryptContext->pOutputData      pCryptContext->pOutputData
  //                                 pCryptContext->OutputDataLen
  //                                 pContext->pProviderError
  //
  // ≈ÒÎË ‡Ò¯ËÙÓ‚˚‚‡ÎË Ó·Î‡ÒÚ¸ Ô‡ÏˇÚË, ÚÓ ÔÓÒÎÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË
  // pCryptContext->pOutputData ·Û‰ÂÚ ÒÓ‰ÂÊ‡Ú¸ ‡Ò¯ËÙÓ‚‡ÌÌ˚Â ‰‡ÌÌ˚Â,
  // pCryptContext->OutputDataLen - ‰ÎËÌÛ ‚˚ıÓ‰Ì˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı,
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË pCryptContext->pOutputData ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ ‚˚Á˚‚‡˛˘ÂÈ
  // ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛
  // ÙÛÌÍˆËË EXT_FreeMemory.
  // ≈ÒÎË Á‡¯ËÙÓ‚˚‚‡ÎË Ù‡ÈÎ, ÚÓ pCryptContext->pOutputData ˇ‚ÎˇÂÚÒˇ ‚ıÓ‰Ì˚Ï
  // Ô‡‡ÏÂÚÓÏ, ‡ pCryptContext->OutputDataLen ÌÂ ËÒÔÓÎ¸ÁÛÂÚÒˇ. –ÂÁÛÎ¸Ú‡ÚÓÏ
  // ‡·ÓÚ˚ ÙÛÌÍˆËË ‚ ‰‡ÌÌÓÏ ÒÎÛ˜‡Â ˇ‚ÎˇÂÚÒˇ ‡Ò¯ËÙÓ‚‡ÌÌ˚È Ù‡ÈÎ, ËÏˇ ÍÓÚÓÓ„Ó
  // ·˚ÎÓ ÔÂÂ‰‡ÌÓ ÙÛÌÍˆËË ‚ Ô‡‡ÏÂÚÂ pCryptContext->pOutputData.
  // -------------------------------------------------------------------------
  TExtDecrypt = function(pContext: PEXT_FULL_CONTEXT;
    pCryptContext: PEXT_CRYPT_CONTEXT; pCallBackData: PEXT_CALLBACK_DATA): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓÎÛ˜ÂÌËˇ ÒÔËÒÍ‡ ÔÓÎÛ˜‡Ú‡ÎÂÈ Á‡¯ËÙÓ‚‡ÌÌ˚ı ‰‡ÌÌ˚ı (Ô‡ÏˇÚË/Ù‡ÈÎ‡)
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pCryptContext         ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ ÍÓÌÚÂÍÒÚ‡ ÔÓ‰ÔËÒË
  //                       EXT_CRYPT_CONTEXT, ÍÓÚÓ‡ˇ ‰ÓÎÊÌ‡ ·˚Ú¸ Á‡ÔÓÎÌÂÌ‡ 
  //                       ÒÎÂ‰Û˛˘ËÏ Ó·‡ÁÓÏ:
  //                            pInputData     = ÛÍ‡Á‡ÚÂÎ¸ Ì‡ Á‡¯ËÙÓ‚‡ÌÌ˚Â ‰‡ÌÌ˚Â
  //                            InputDataLen   = ‰ÎËÌ‡ Á‡¯ËÙÓ‚‡ÌÌ˚ı ‰‡ÌÌ˚ı ‚ ·‡ÈÚ‡ı.
  //                                           ƒÎˇ Ù‡ÈÎ‡ ‰‡ÌÌ˚È Ô‡‡ÏÂÚ ÌÂ ËÏÂÂÚ 
  //                                           ÁÌ‡˜ÂÌËˇ, Ú‡Í Í‡Í ‡ÁÏÂ Ù‡ÈÎ‡ ·Û‰ÂÚ
  //                                           ‚˚˜ËÒÎÂÌ ‚ÌÛÚË ÙÛÌÍˆËË;
  //                            DataType       = “ËÔ ‰‡ÌÌ˚ı (Ô‡ÏˇÚ¸ / Ù‡ÈÎ)
  //                            Flags          = 0
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ                ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext->pCryptoProvider
  // pCryptContext->pInputData
  // pCryptContext->InputDataLen
  // pCryptContext->DataType
  // pCryptContext->Flags
  //                                 pCryptContext->pReceivers
  //                                 pContext->pProviderError
  //
  // œÓÒÎÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË Ô‡‡ÏÂÚ pCryptContext->pReceivers ·Û‰ÂÚ ÒÓ‰ÂÊ‡Ú¸
  // ÒÔËÒÓÍ ÔÓÎÛ˜‡ÚÂÎÂÈ Á‡¯ËÙÓ‚‡ÌÌ˚ı ‰‡ÌÌ˚ı. ‘ÓÏ‡Ú ÒÔËÒÍ‡ ÔÓÎÛ˜‡Ú‡ÎÂÈ ÒÏ.
  // ‚ ÓÔËÒ‡ÌËË ÒÚÛÍÚÛ˚ EXT_CRYPT_CONTEXT.
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË pCryptContext->pReceivers ÓÒ‚Ó·ÓÊ‰‡ÂÚÒˇ ‚˚Á˚‚‡˛˘ÂÈ
  // ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛
  // ÙÛÌÍˆËË EXT_FreeMemory.
  // -------------------------------------------------------------------------
  TExtGetReceivers = function(pContext: PEXT_FULL_CONTEXT;
    pCryptContext: PEXT_CRYPT_CONTEXT): Integer; stdcall;

  // -------------------------------------------------------------------------
  // ‘ÛÌÍˆËˇ ÔÓÎÛ˜ÂÌËˇ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ, ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘Ëı
  // ÛÍ‡Á‡ÌÌÓÏÛ ÔÒÂ‚‰ÓÌËÏÛ
  //
  // Œ·˚˜ÌÓ ËÒÔÓÎ¸ÁÛÂÚÒˇ, ÂÒÎË Ó‰ÌÓÏÛ ÔÒÂ‚‰ÓÌËÏÛ ÒÓÔÓÒÚ‡‚ÎÂÌÓ ÌÂÒÍÓÎ¸ÍÓ
  // ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ. ¬ ÓÚÎË˜ËÂ ÓÚ ÙÛÌÍˆËËË EXT_GetUserID, ÍÓÚÓ‡ˇ
  // ‚ÓÁ‚‡˘‡ÂÚ Ó‰ÌÓ„Ó ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ, ‰‡ÌÌ‡ˇ ÙÛÌÍˆËˇ ‚ÓÁ‚‡˘‡ÂÚ ÒÔËÒÓÍ
  // ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ, ‰Îˇ ÍÓÚÓ˚ı ÒÓ‚Ô‡Î ÛÍ‡Á‡ÌÌ˚È ÔÒÂ‚‰ÓÌËÏ.
  //
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË, Ì‡ ÍÓÚÓÛ˛ ÛÍ‡Á˚‚‡ÂÚ ppszUserIDList
  // ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡ ‚˚Á˚‚‡˛˘ÂÈ ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ
  // Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı, Ò ÔÓÏÓ˘¸˛ ÙÛÌÍˆËË EXT_FreeMemory.
  // œÓÒÎÂ ÓÚ‡·ÓÚÍË ÙÛÌÍˆËË EXT_GetUserIDList Ô‡‡ÏÂÚ ppszUserIDList ·Û‰ÂÚ
  // ÒÓ‰ÂÊ‡Ú¸ ÛÍ‡Á‡ÚÂÎ¸ Ì‡ ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ Á‡Â„ËÒÚËÓ‚‡ÌÌ˚ı ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ.
  // ‘ÓÏ‡Ú ÒÔËÒÍ‡ ÔÓÎÛ˜‡ÚÂÎÂÈ ÒÏ. ‚ ÓÔËÒ‡ÌËË ÒÚÛÍÚÛ˚ EXT_CRYPT_CONTEXT.
  // Œ·Î‡ÒÚ¸ Ô‡ÏˇÚË, Ì‡ ÍÓÚÓÛ˛ ÛÍ‡Á˚‚‡ÂÚ ppszUserIDList ‰ÓÎÊÌ‡ ·˚Ú¸ ÓÒ‚Ó·ÓÊ‰ÂÌ‡
  // ‚˚Á˚‚‡˛˘ÂÈ ÙÛÌÍˆËÂÈ, ÔÓÒÎÂ ÚÓ„Ó, Í‡Í ÓÚÔ‡‰‡ÂÚ Ì‡‰Ó·ÌÓÒÚ¸ ‚ ˝ÚËı ‰‡ÌÌ˚ı,
  // Ò ÔÓÏÓ˘¸˛ ÙÛÌÍˆËË EXT_FreeMemory.
  //
  // œ‡‡ÏÂÚ˚ ÙÛÌÍˆËË:
  //
  // œ‡‡ÏÂÚ              ŒÔËÒ‡ÌËÂ
  //
  // pContext              ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÛÍÚÛÛ EXT_FULL_CONTEXT
  // pszUserAlias          ”Í‡Á‡ÚÂÎ¸ Ì‡ ÒÚÓÍÛ, ÒÓ‰ÂÊ‡˘Û˛ ÔÒÂ‚‰ÓÌËÏ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ;
  // ppszUserIDList        ”Í‡Á‡ÚÂÎ¸ Ì‡ ÛÍ‡Á‡ÚÂÎ¸, ÔÓ ÍÓÚÓÓÏÛ ·Û‰ÂÚ ‚ÓÁ‚‡˘ÂÌ
  //                       ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚ Á‡Â„ËÒÚËÓ‚‡ÌÌ˚ı ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ.
  //                       ‘ÓÏ‡Ú ÒÔËÒÍ‡ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ ÒÏ. ‚ ÓÔËÒ‡ÌËË ÒÚÛÍÚÛ˚
  //                       EXT_CRYPT_CONTEXT.
  // pUserIDListSize       ”Í‡Á‡ÚÂÎ¸ Ì‡ ÔÂÂÏÂÌÌÛ˛, ‚ ÍÓÚÓÛ˛ ·Û‰ÂÚ ‚ÓÁ‚‡˘ÂÌ ‡ÁÏÂ
  //                       Ô‡ÏˇÚË, ‚˚‰ÂÎÂÌÌ˚È ÔÓ‰ ÒÔËÒÓÍ Ë‰ÂÌÚËÙËÍ‡ÚÓÓ‚
  //                       ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÈ. ÃÓÊÂÚ ·˚Ú¸ ÔÂÂ‰‡Ì NULL, ÂÒÎË ÌÂ ÌÛÊÌÓ
  //                       ‚ÓÁ‚‡˘‡Ú¸ ÍÓÎË˜ÂÒÚ‚Ó ‚˚‰ÂÎÂÌÌÓÈ Ô‡ÏˇÚË. œ‡‡ÏÂÚ ÏÓÊÂÚ
  //                       ·˚Ú¸ ËÒÔÓÎ¸ÁÓ‚‡Ì ÔË ÓÒ‚Ó·ÓÊ‰ÂÌËË Ô‡ÏˇÚË ÔË ÔÂÂ‰‡˜Â
  //                       ‚ ÙÛÌÍˆË˛ EXT_FreeMemory
  //
  // ¬ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ           ¬˚ıÓ‰Ì˚Â ÁÌ‡˜ÂÌËˇ
  // pContext
  // pszUserAlias
  // ppszUserIDList             ppszUserIDList
  // pUserIDListSize            pUserIDListSize
  //                            pContext->pProviderError
  // -------------------------------------------------------------------------
  TExtGetUserIDListByAlias = function(pContext: PEXT_FULL_CONTEXT;
    const pszUserAlias: PChar; var ppszUserIDList: PChar;
    var pUserIDListSize: Integer): Integer; stdcall;

  // -------------------------------------------------------------------
  // EXT_GenRandom Á‡ÔÓÎÌˇÂÚ ·ÛÙÂ pbBuffer ÒÎÛ˜‡ÈÌ˚ÏË dwLen ·‡ÈÚ‡ÏË.
  // ¬ ÒÎÛ˜‡Â ÛÒÔÂı‡ ÙÛÌÍˆËˇ ‚ÓÁ‚‡˘‡ÂÚ 0.
  // -------------------------------------------------------------------
  TExtGenRandom = function(pContext: PEXT_FULL_CONTEXT;
    pbBuffer: PChar; dwLen: dWord): Integer; stdcall;

  // -------------------------------------------------------------------
  // EXT_HashData ‚˚ÔÓÎÌˇÂÚ ıÂ¯ËÓ‚‡ÌËÂ ‰‡ÌÌ˚ı, ‡ÒÔÓÎÓÊÂÌÌ˚ı
  // ÔÓ ‡‰ÂÒÛ pbData ‰ÎËÌÓÈ dwDataLen ·‡ÈÚ.
  // ¬ ÒÎÛ˜‡Â ÛÒÔÂı‡ ÙÛÌÍˆËˇ ‚ÓÁ‚‡˘‡ÂÚ 0.
  //
  // ≈ÒÎË pbHash ‡‚ÂÌ ÌÛÎ˛, ÚÓ ÔÓ ‡‰ÂÒÛ pdwHashLen ·Û‰ÂÚ Ì‡ıÓ‰ËÚ¸Òˇ 
  // ˜ËÒÎÓ, ÛÍ‡Á˚‚‡˛˘ÂÂ Ì‡ ‡ÁÏÂ ‚˚ıÓ‰ÌÓ„Ó hash-ÁÌ‡˜ÂÌËˇ.
  // ≈ÒÎË pbHash ÌÂ ‡‚ÂÌ ÌÛÎ˛, ÚÓ ÔÓ ÛÍ‡Á‡ÌÌÓÏÛ ‡‰ÂÒÛ ·Û‰ÂÚ 
  // ÔÓËÁ‚Â‰ÂÌÓ ÍÓÔËÓ‚‡ÌËÂ hash-ÁÌ‡˜ÂÌËˇ ‡ÁÏÂÓÏ, ‡‚Ì˚Ï *pdwHashLen.
  // ≈ÒÎË ‡ÁÏÂ, Ì‡ ÍÓÚÓ˚È ÛÍ‡Á˚‚‡ÂÚ pdwHashLen ÔÂ‚˚¯‡ÂÚ Ï‡ÍÒËÏ‡Î¸ÌÛ˛
  // ‰ÎËÌÛ hash-ÁÌ‡˜ÂÌËˇ, ÚÓ ÙÛÌÍˆËˇ ‚ÂÌÂÚ ÍÓ‰, ÛÍ‡Á˚‚‡˛˘ËÈ Ì‡ ÌÂ‚ÂÌÓ
  // Á‡‰‡ÌÌ˚Â Ô‡‡ÏÂÚ˚.
  // -------------------------------------------------------------------
  TExtHashData = function(pContext: PEXT_FULL_CONTEXT;
    const pbData: PChar; dwDataLen: dWord;
    pbHash: PChar; var pdwHashLen: dWord): Integer; stdcall;
  // ¬ÓÁ‚‡Ú ÒÚÓÍÓ‚Ó„Ó ÁÌ‡˜ÂÌËˇ Ó¯Ë·ÍË Ì‡ ‡Ì„ÎËÈÒÍÓÏ Ë ÛÒÒÍÓÏ
  //   Err - ÌÓÏÂ Ó¯Ë·ÍË
  //   ÂÁÛÎ¸Ú‡Ú - ÒÚÓÍ‡ ÒÓÓ·˘ÂÌËˇ
  function ErrToStr(Err: Integer): string;

  // ---------------------------------------------------------------------------------
  //   ‘ÛÌÍˆËˇ GetSignIssuerName ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ ËÌÙÓÏ‡ˆËË
  //   (‚ ‰‡ÌÌÓÏ ÒÎÛ˜‡Â, ‚ÓÁ‚‡˘‡ÂÚÒˇ ÚÓÎ¸ÍÓ ËÏˇ (ÔÓÎÂ Subject))
  //   Ó ÔÓ‰ÔËÒ‡‚¯ÂÏ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂ.
  //
  //   œ‡‡ÏÂÚ˚:
  //   pEncodedCertificate   -    «‡ÍÓ‰ËÓ‚‡ÌÌ˚È ÒÂÚËÙËÍ‡Ú (ÔÓÎÛ˜ÂÌÌ˚È, Ì‡ÔËÏÂ,
  //                             ÔË ‚˚ÁÓ‚Â ÙÛÌÍˆËË ÔÓ‚ÂÍË ÔÓ‰ÔËÒË)
  //   EncodedCertSize       -    ƒÎËÌ‡ Á‡ÍÓ‰ËÓ‚‡ÌÌÓ„Ó ÒÂÚËÙËÍ‡Ú‡
  //   pName                 -    ”Í‡Á‡ÚÂÎ¸ Ì‡ ˇ˜ÂÈÍÛ, ÒÓ‰ÂÊ‡˘Û˛ ÛÍ‡Á‡ÚÂÎ¸ ÒÚÓÍË,
  //                              ‚ ÍÓÚÓÛ˛ ‚ÂÌÂÚÒˇ ËÏˇ ÔÓ‰ÔËÒ‡‚¯Â„Ó ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ
  //   pNameLen              -    ”Í‡Á‡ÚÂÎ¸ Ì‡ ˇ˜ÂÈÍÛ Ò ‰ÎËÌÓÈ ÒÚÓÍË.
  //                              ƒÎËÌ‡ ÒÚÓÍË ‚ÍÎ˛˜‡ÂÚ '\0'.
  // ---------------------------------------------------------------------------------
  function GetSignIssuerName(const pEncodedCertificate: Pointer;
    const EncodedCertSize: dWord; var pSignInfo: PChar; var pSignInfoLen: dWord): Boolean;

  // ---------------------------------------------------------------------------------
  //   ‘ÛÌÍˆËˇ GetSignTime ÔÂ‰Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ÔÓÎÛ˜ÂÌËˇ ËÌÙÓÏ‡ˆËË
  //   ‰‡Ú˚/‚ÂÏÂÌË ÔÓ‰ÔËÒË
  //
  //   œ‡‡ÏÂÚ˚:
  //   pEncodedCertificate   -    «‡ÍÓ‰ËÓ‚‡ÌÌ‡ˇ ÒÚÛÍÚÛ‡ Ò ËÌÙÓÏ‡ˆËÂÈ ÔÓ
  //                              ÔÓ‰ÔËÒ‡‚¯ÂÏÛ ÔÓÎ¸ÁÓ‚‡ÚÂÎ˛
  //   EncodedSignerInfoSize -    ƒÎËÌ‡ «‡ÍÓ‰ËÓ‚‡ÌÌÓÈ ÒÚÛÍÚÛ˚
  //   pSignTime             -    ”Í‡Á‡ÚÂÎ¸ Ì‡ ƒ‡ÚÛ/¬ÂÏˇ ÔÓ‰ÔËÒË
  // ---------------------------------------------------------------------------------
  function GetSignTime(const pEncodedSignerInfo: Pointer;
    const EncodedSignerInfoSize: dWord; var ATime: TDateTime): Boolean;

function InitUserNameList(fc: PEXT_FULL_CONTEXT;
  GetMes: Boolean; var Mes: string): Boolean;
procedure DoneUserNameList;
function GetUserIdByName(pContext: PEXT_FULL_CONTEXT; const AName: string): string;
function LoadItscLib(var Mes: string): Boolean;
function IsItscLibLoaded: Boolean;
procedure FreeItscLib;
function GetExtPtr(FuncIndex: Integer): Pointer;

//  GetExtPtr(fi))(

const
  Tcc_Itcs_Dll = 'tcc_itcs.dll';

const
  fiInitCrypt               = 0;
  fiInitCryptEx             = 1;
  fiCloseCrypt              = 2;
  fiFreeMemory              = 3;
  fiAllocMemory             = 4;
  fiGetErrorDefinition      = 5;
  fiRetCode2WinErr          = 6;
  fiRetCode2HResult         = 7;
  fiGetOwnID                = 8;
  fiGetUserIDList           = 9;
  fiGetUserAlias            = 10;
  fiGetUserID               = 11;
  fiSign                    = 12;
  fiVerifySign              = 13;
  fiGetSignInfo             = 14;
  fiVerifyViewSignResult    = 15;
  fiViewSignResult          = 16;
  fiGetSignatureSize        = 17;
  fiGetCurrentCertificate   = 18;
  fiViewEncodedCertificate  = 19;
  fiViewCertificate         = 20;
  fiEncrypt                 = 21;
  fiDecrypt                 = 22;
  fiGetReceivers            = 23;
  fiGetUserIDListByAlias    = 24;
  fiGenRandom               = 25;
  fiHashData                = 26;

implementation

var
  FuncList: array[0..26] of
    record
      flDllName: PChar;
      flPtr: Pointer;
    end =
  (
    (flDllName: 'EXT_InitCrypt';               flPtr: nil),
    (flDllName: 'EXT_InitCryptEx';             flPtr: nil),
    (flDllName: 'EXT_CloseCrypt';              flPtr: nil),
    (flDllName: 'EXT_FreeMemory';              flPtr: nil),
    (flDllName: 'EXT_AllocMemory';             flPtr: nil),
    (flDllName: 'EXT_GetErrorDefinition';      flPtr: nil),
    (flDllName: 'EXT_RetCode2WinErr';          flPtr: nil),
    (flDllName: 'EXT_RetCode2HResult';         flPtr: nil),
    (flDllName: 'EXT_GetOwnID';                flPtr: nil),
    (flDllName: 'EXT_GetUserIDList';           flPtr: nil),
    (flDllName: 'EXT_GetUserAlias';            flPtr: nil),
    (flDllName: 'EXT_GetUserID';               flPtr: nil),
    (flDllName: 'EXT_Sign';                    flPtr: nil),
    (flDllName: 'EXT_VerifySign';              flPtr: nil),
    (flDllName: 'EXT_GetSignInfo';             flPtr: nil),
    (flDllName: 'EXT_VerifyViewSignResult';    flPtr: nil),
    (flDllName: 'EXT_ViewSignResult';          flPtr: nil),
    (flDllName: 'EXT_GetSignatureSize';        flPtr: nil),
    (flDllName: 'EXT_GetCurrentCertificate';   flPtr: nil),
    (flDllName: 'EXT_ViewEncodedCertificate';  flPtr: nil),
    (flDllName: 'EXT_ViewCertificate';         flPtr: nil),
    (flDllName: 'EXT_Encrypt';                 flPtr: nil),
    (flDllName: 'EXT_Decrypt';                 flPtr: nil),
    (flDllName: 'EXT_GetReceivers';            flPtr: nil),
    (flDllName: 'EXT_GetUserIDListByAlias';    flPtr: nil),
    (flDllName: 'EXT_GenRandom';               flPtr: nil),
    (flDllName: 'EXT_HashData';                flPtr: nil)
  );

const
  ExtErrMes: array[0..204] of PChar = (
    'There was no error',
    'Key diskette was not found',
    'The entered password is not right',
    'The directory is not accessible',
    'The specified file not found',
    'Error while reading file',
    'Error while writing into file',
    'Decrypting or imito check detected distortion',
    'The directory was not found',
    'Invalid passwords are limited',
    'The user refused from entering password',
    'The password was not entered',
    'The specified message was not kvitted. It is not an error',
    'The specified message was delivered to recipient. It is not an error',
    'The message was used (read, printed, etc.) by recipient. Not an error',
    'No registered sent message corresponding to received kvit',
    'Not enough memory',
    'Error while opening file',
    'Directory can not have such name',
    'Access to file denied',
    'Error while closing file',
    'Error while positioning in file',
    'Wrong structure of structured file',
    'Wrong structure of file *.abn',
    'Wrong structure of file *.apn',
    'Wrong structure of glued file',
    'The file nodename.doc not maintaining the server ID for given AP, but this ID must be present',
    'The searching ID of the Abonent Point was not found',
    'Function received incorrect parameters',
    'Password too long or too small',
    'Identifier has wrong length',
    'Directory is empty but it should not be such',
    'Desired key (of any type) was not found',
    'The specified length of the ID of abonent, that we need to make Key Disk, is wrong',
    'The specified length of the abonent name is wrong',
    'Not enough disk space',
    'The returned value does not correspond to any code',
    'Index is beyond proper bounds',
    'function received identifier of not proper type',
    'The file NNNNAAAA.abn maintain the abonent ID, that differs from NNNNAAAA',
    'The random number has repeted',
    'File''s (dir''s) attr. can''t be received or set',
    'Is used to turn off initialization of any kind or when creating an object without initialization',
    'Error while deleting file',
    'Error while renaming file',
    'Error while  get file size',
    'Count abonent is empty',
    'Error while process compressing',
    'Error while process decompressing',
    'No flag infotecs (ITCS)',
    'Error while coping string',
    'Get file info (date, time, attributes...)',
    'Error while finding file',
    'Error can''t get full path (not file or other error)',
    'Error can''t get offset in the file',
    'File name of envelope must be @*******.***; Receipt N|D|R******.***',
    'Bad version envelope',
    'No Envelope',
    'Bad key',
    'Bad header of envelope',
    'Can''t seting working directory',
    'Error while creating directory',
    'Error while deleting directory',
    'Error while creating file',
    'Error while coping  file',
    'The abonent is not registered at the given AP',
    'This not package',
    'Document not found',
    'Document list is empty',
    'Can''t unpack file',
    'Can''t file pack',
    'Invalid handle (pointer to CKeyDisk)',
    'signature not equal ''CrYpT''',
    'only GOST crypting allowed',
    'File is corrupted',
    'Unknown type of receipt',
    'No receipt',
    'This envelope',
    'Bad wersion receipt',
    'Denied adress receiver',
    'Denied adress sender',
    'Is long name of directory',
    'Exe-file receives wrong number of parameters',
    'Error database',
    'Database is full',
    'Record not found',
    'Document was removed',
    'Invalid sender address',
    'Invalid receiver address',
    'Document is already packed',
    'Document not found',
    'Error header envelope writing',
    'Error header envelope reading',
    'Error header envelope removing',
    'Encrypt file error',
    'Decrypt file error',
    'Imito file error',
    'The specified abonent ID or Name is not found',
    'The Sign of the Chief abonent in NNNN_spr.sgn is not valid',
    'A file or memory already signed by specified abonent',
    'Envelope is assign for another task application',
    'The specified workgroup absent in address book',
    'Error open DB Table',
    'Error read table to list',
    'Error update DB table record',
    'The parameters of objrcts to com-pare are not matched or wrong',
    'The user rights are not suitable for some operation',
    'Some time period is overdue (or taken out from using)',
    'Some operation is wrong',
    'Branch to next element',
    'Error read special file',
    'Read error package''s header',
    'Read error package''s document',
    'The numbers of masters are not mathing',
    'No any net masters for generation',
    'Function not implemented',
    'End of files searching',
    'Function not implemented in some case',
    'CurPos() failed',
    'Truncate () failed',
    'Flush() failed',
    'File already exist',
    'Set file time',
    'Get file time',
    'File move error',
    'Use GetLastError',
    'Get disk free or total',
    'End of stream was reached',
    'Preset dictionary needed',
    'Error occurred in the file system, you may consult errno to get the exact error code',
    'The stream state was inconsistent (for example  if next_in or next_out was NULL)',
    'The input data was corrupted',
    'No progress is possible or if there was not enough room in the output buffer',
    'The library version is incompatible with the version assumed by the caller',
    'The file struct unexpected',
    'The network number is incorrect',
    'The version is incorrect',
    'The task number is incorrect',
    'The Chief abonent is not found in NNNN.chf',
    'The WS is not registered for this task',
    'The document not signed',
    'Error during checking sign',
    'Something not installed',
    'Some operation already done',
    'Drive not ready',
    'Occuring in trying to copy the files with create time less then existing',
    'Error during LoadLibrary',
    'Error during GetProcAddress',
    'An operation has been cancelled by user',
    'The premature operation, Check Your system time, please',
    'The settings are incorrect',
    'Crypted another ser',
    'Crypted this ser another pass',
    'Crypted this ser this pass',
    'No crypted',
    'Crypted another mode',
    'The operation can not be executed',
    'The IDs are coincide (the same or something else)',
    'The IDs are not coincide (different or something else)',
    'Not an error, but UNDO was encountered cause of the some error or the cancel be user',
    'Transport receipt has not allowed status',
    'Different imito key',
    'Different imito header',
    'Deimito file error',
    'Aplication disabled',
    'IP-traffic was locked', '', '', '', '',
    'Error address Callback Function',
    'Invalid code of device',
    'Aborted wait fo device',
    'Error create object of device',
    'Driver or device not installed',
    'Reading Mistake ID key',
    'Wrong slot of device',
    'Undefined function',
    'Key not inserted in device',
    'Error reading from device',
    'Error writing to device',
    'Error lentgh reading or writing',
    'Error data of chief sign',
    'Wrong file name',
    'Error during RegOpenKey',
    'Error during RegQueryValueEx',
    'Error during SwitchDesktop',
    'Error during SystemParametersInfo',
    'Error during CreateWindowEx',
    'Unlock impossible - Locker Busy',
    'Error during CreateDesktop',
    'Error during CreateThread',
    'The user has no right to sign',
    'The user was removed from VPN',
    'Missing (arbitrary) object',
    '(Arbitrary) object already exists',
    'Missing attachment file',
    'Mail size is beyond message store size limit',
    'Error in function of processing alternative devices data storage',
    'Save CSP defence  key to reg',
    'The chief subscriber tryes to create the new digital signature on the AP',
    'The subscriber tryes to create the new digital signature on the nonprime AP',
    'A required certificate is not valid',
    'A required certificate is not within its validity period',
    'The current user sign certificate is incompatible with the format of the signed file'
  );

  ExtErrMesRus: array[0..204] of PChar = (
    'ÕÂ ËÏÂÎÓÒ¸ ÌËÍ‡ÍÓÈ Ó¯Ë·ÍË',
    ' Î˛˜Â‚‡ˇ ‰ËÒÍÂÚ‡ ÌÂ ·˚Î‡ Ì‡È‰ÂÌ‡',
    '¬‚Â‰ÂÌÌ˚È Ô‡ÓÎ¸ ÌÂ ‚ÂÂÌ',
    ' ‡Ú‡ÎÓ„ ÌÂ‰ÓÒÚÛÔÂÌ',
    '”Í‡Á‡ÌÌ˚Â Ù‡ÈÎ ÌÂ Ì‡È‰ÂÌ',
    'Œ¯Ë·Í‡ ÔË ˜ÚÂÌËË Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ÔË Á‡ÔËÒË ‚ Ù‡ÈÎ',
    'ƒÂ¯ËÙÓ‚Í‡ ËÎË ËÏËÚÓ-‚ÒÚ‡‚Í‡ ËÒÍ‡ÊÂÌ˚',
    ' ‡Ú‡ÎÓ„ ÌÂ ·˚Î Ì‡È‰ÂÌ',
    'ÕÂ‰ÓÔÛÒÚËÏ˚Â Ô‡ÓÎË Ó„‡ÌË˜ÂÌ˚',
    'œÓÎ¸ÁÓ‚‡ÚÂÎ¸ ÓÚÍ‡Á‡ÎÒˇ ÓÚ ‚‚Ó‰‡ Ô‡ÓÎˇ',
    'œ‡ÓÎ¸ ÌÂ ·˚Î ‚‚Â‰ÂÌ',
    'ŒÔÂ‰ÂÎÂÌÌÓÂ ÒÓÓ·˘ÂÌËÂ ÌÂ ·˚ÎÓ ÒÍ‚ËÚÓ‚‡ÌÓ. ›ÚÓ ÌÂ Ó¯Ë·Í‡',
    'ŒÔÂ‰ÂÎÂÌÌÓÂ ÒÓÓ·˘ÂÌËÂ ·˚ÎÓ ÔÓÒÚ‡‚ÎÂÌÓ ÔÓÎÛ˜‡ÚÂÎ˛ (ÔËÂÏÌËÍÛ). ›ÚÓ ÌÂ Ó¯Ë·Í‡',
    '—ÓÓ·˘ÂÌËÂ ËÒÔÓÎ¸ÁÓ‚‡ÎÓÒ¸ (˜ÚÂÌËÂ, Ì‡ÔÂ˜‡Ú‡ÌÓ, Ë Ú.‰.) ÔÓÎÛ˜‡ÚÂÎÂÏ (ÔËÂÏÌËÍÓÏ). ›ÚÓ ÌÂ Ó¯Ë·Í‡',
    'ÕÂÚ Á‡Â„ËÒÚËÓ‚‡ÌÌÓ„Ó ÔÓÒÎ‡ÌÌÓ„Ó ÒÓÓ·˘ÂÌËˇ ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘Â„Ó ÔÓÎÛ˜ÂÌÌÓÈ Í‚ËÚÓ‚ÍÂ',
    'ÕÂ‰ÓÒÚ‡ÚÓ˜ÌÓ Ô‡ÏˇÚË',
    'Œ¯Ë·Í‡ ÔË ÓÚÍ˚ÚËË Ù‡ÈÎ‡',
    ' ‡Ú‡ÎÓ„ ÌÂ ÏÓÊÂÚ ËÏÂÚ¸ Ú‡ÍÓ„Ó ËÏÂÌË',
    'ƒÓÒÚÛÔ Í Ù‡ÈÎÛ Á‡ÔÂ˘ÂÌ',
    'Œ¯Ë·Í‡ ÔË Á‡Í˚ÚËË Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ÔË ÔÓÁËˆËÓÌËÓ‚‡ÌËË ‚ Ù‡ÈÎÂ',
    'ÕÂÔ‡‚ËÎ¸Ì‡ˇ ÒÚÛÍÚÛ‡ ÒÚÛÍÚÛÌÓ„Ó Ù‡ÈÎ‡',
    'ÕÂÔ‡‚ËÎ¸Ì‡ˇ ÒÚÛÍÚÛ‡ Ù‡ÈÎ‡ *. abn',
    'ÕÂÔ‡‚ËÎ¸Ì‡ˇ ÒÚÛÍÚÛ‡ Ù‡ÈÎ‡ *. apn',
    'ÕÂÔ‡‚ËÎ¸Ì‡ˇ ÒÚÛÍÚÛ‡ ÒÍÎÂË‚‡˛˘Â„ÓÒˇ Ù‡ÈÎ‡',
    '‘‡ÈÎ nodename.doc ÌÂ ÒÓ‰ÂÊËÚ »ƒ≈Õ“»‘» ¿“Œ– ÒÂ‚Â‡ ‰Îˇ ‰‡ÌÌÓ„Ó ¿œ, ÌÓ ˝ÚÓÚ »ƒ≈Õ“»‘» ¿“Œ– ‰ÓÎÊÂÌ ÔËÒÛÚÒÚ‚Ó‚‡Ú¸',
    '–‡Á˚ÒÍË‚‡ÂÏ˚È »ƒ≈Õ“»‘» ¿“Œ– “Ó˜ÍË ¿·ÓÌÂÌÚ‡ ÌÂ Ì‡È‰ÂÌ',
    '‘ÛÌÍˆËˇ ÔÓÎÛ˜ËÎ‡ ÌÂÔ‡‚ËÎ¸Ì˚Â Ô‡‡ÏÂÚ˚',
    'œ‡ÓÎ¸ ÒÎË¯ÍÓÏ ‰ÎËÌÌ˚È ËÎË ÒÎË¯ÍÓÏ ÍÓÓÚÍËÈ',
    '»‰ÂÌÚËÙËÍ‡ÚÓ ËÏÂÂÚ ÌÂÔ‡‚ËÎ¸ÌÛ˛ ‰ÎËÌÛ',
    ' ‡Ú‡ÎÓ„ ÔÛÒÚ, ÌÓ ˝ÚÓ ÌÂ ‰ÓÎÊÌÓ ·˚Ú¸ Ú‡Í',
    '∆ÂÎ‡ÚÂÎ¸Ì˚È ÍÎ˛˜ (Î˛·Ó„Ó ÚËÔ‡) ÌÂ ·˚Î Ì‡È‰ÂÌ',
    '”Í‡Á‡ÌÌ‡ˇ ‰ÎËÌ‡ »ƒ≈Õ“»‘» ¿“Œ–¿ ‡·ÓÌÂÌÚ‡, ÍÓÚÓ‡ˇ ÌÛÊÌ‡ ‰Îˇ ÒÓÁ‰‡ÌËˇ  Î˛˜Â‚Ó„Ó ‰ËÒÍ‡, ˇ‚ÎˇÂÚÒˇ ÌÂÔ‡‚ËÎ¸ÌÓÈ.',
    '”Í‡Á‡ÌÌ‡ˇ ‰ÎËÌ‡ ËÏÂÌË ‡·ÓÌÂÌÚ‡ ÌÂÔ‡‚ËÎ¸Ì‡',
    'ÕÂ‰ÓÒÚ‡ÚÓ˜ÌÓ ‰ËÒÍÓ‚Ó„Ó ÔÓÒÚ‡ÌÒÚ‚‡',
    '¬ÓÁ‚‡˘ÂÌÌÓÂ ÁÌ‡˜ÂÌËÂ ÌÂ ÒÓÓÚ‚ÂÚÒÚ‚ÛÂÚ ÌËÍ‡ÍÓÏÛ ÍÓ‰Û',
    '»Ì‰ÂÍÒ ‚ÌÂ ÒÓÓÚ‚ÂÚÒÚ‚Û˛˘Ëı ÔÂ‰ÂÎÓ‚',
    '‘ÛÌÍˆËÓÌ‡Î¸Ì˚È ÔÓÎÛ˜ÂÌÌ˚È Ë‰ÂÌÚËÙËÍ‡ÚÓ ÌÂÒÓÓÚ‚ÂÚÒÚ‚Û˛˘Â„Ó ÚËÔ‡',
    '‘‡ÈÎ NNNNAAAA.ABN ÔÓ‰‰ÂÊË‚‡ÂÚ »ƒ≈Õ“»‘» ¿“Œ– ‡·ÓÌÂÌÚ‡, ÍÓÚÓ˚È ÓÚÎË˜‡ÂÚÒˇ ÓÚ NNNNAAAA',
    '—ÎÛ˜‡ÈÌÓÂ ˜ËÒÎÓ ·˚ÎÓ ÔÓ‚ÚÓÂÌÓ',
    '¿ÚË·ÛÚ˚ Ù‡ÈÎ‡ (Í‡Ú‡ÎÓ„‡) ÌÂ ÏÓ„ÛÚ ·˚Ú¸ ÔÓÎÛ˜ÂÌ˚ ËÎË ÛÒÚ‡ÌÓ‚ÎÂÌ˚',
    '»ÒÔÓÎ¸ÁÛÂÚÒˇ, ˜ÚÓ·˚ ‚˚ÍÎ˛˜ËÚ¸ ËÌËˆË‡ÎËÁ‡ˆË˛ Î˛·Ó„Ó ‚Ë‰‡ ËÎË ÔË ÒÓÁ‰‡ÌËË Ó·˙ÂÍÚ‡ ·ÂÁ ËÌËˆË‡ÎËÁ‡ˆËË',
    'Œ¯Ë·Í‡ ÔË Û‰‡ÎÂÌËË Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ÔË ÔÂÂËÏÂÌÓ‚‡ÌËË Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ‚Ó ‚ÂÏˇ ÔÓÎÛ˜ÂÌËˇ ‡ÁÏÂ‡ Ù‡ÈÎ‡',
    '¿·ÓÌÂÌÚ —˜ÂÚ‡ ÔÛÒÚ',
    'Œ¯Ë·Í‡ ‚Ó ‚ÂÏˇ ÔÓˆÂÒÒ‡ ÒÊ‡ÚËˇ',
    'Œ¯Ë·Í‡ ‚Ó ‚ÂÏˇ ÔÓˆÂÒÒ‡ ‰ÂÍÓÏÔÂÒÒËË',
    'ÕÂÚ ÙÎ‡ÊÍÓ‚ »ÌÙÓÚÂÍÒ‡ (ITCS).',
    'Œ¯Ë·Í‡ ÔË ÍÓÔËÓ‚‡ÌËË ÒÚÓÍË',
    'œÓÎÛ˜ËÚÂ ËÌÙÓÏ‡ˆË˛ Ù‡ÈÎ‡ (‰‡Ú‡, ‚ÂÏˇ, ‡ÚË·ÛÚ˚...)',
    'Œ¯Ë·Í‡ ÔË Ì‡ıÓÊ‰ÂÌËË Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ÌÂ ÏÓÊÂÚ ÔÓÎÛ˜ËÚ¸ ÔÓÎÌ˚È ÔÛÚ¸ (ÌÂ Ù‡ÈÎÓ‚‡ˇ ËÎË ‰Û„‡ˇ Ó¯Ë·Í‡)',
    'Œ¯Ë·Í‡ ÌÂ ÏÓÊÂÚ ÔÓÎÛ˜‡Ú¸ ÒÏÂ˘ÂÌËÂ ‚ Ù‡ÈÎÂ',
    '»Ïˇ Ù‡ÈÎ‡ Ó·ÓÎÓ˜ÍË ‰ÓÎÊÌÓ ·˚Ú¸ @*******. ***; œÓÎÛ˜ÂÌËÂ N|D|R ******. ***',
    'œÎÓı‡ˇ ‚ÂÒËˇ Ó·ÓÎÓ˜ÍË',
    'ÕÂÚ Ó·ÓÎÓ˜ÍË',
    'œÎÓıÓÈ ÍÎ˛˜',
    'œÎÓıÓÈ Á‡„ÓÎÓ‚ÓÍ Ó·ÓÎÓ˜ÍË',
    'ÕÂ ÏÓ„Û Á‡‰‡Ú¸ ‡·Ó˜ËÈ Í‡Ú‡ÎÓ„',
    'Œ¯Ë·Í‡ ÔË ÒÓÁ‰‡ÌËË Í‡Ú‡ÎÓ„‡',
    'Œ¯Ë·Í‡ ÔË Û‰‡ÎÂÌËË Í‡Ú‡ÎÓ„‡',
    'Œ¯Ë·Í‡ ÔË ÒÓÁ‰‡ÌËË Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ÔË ÍÓÔËÓ‚‡ÌËË Ù‡ÈÎ‡',
    '¿·ÓÌÂÌÚ ÌÂ Á‡Â„ËÒÚËÓ‚‡Ì ‚ ‰‡ÌÌÓÏ ¿√≈Õ“—“¬≈ ¿œ',
    '›ÚÓÚ ÌÂ Ô‡ÍÂÚ',
    'ƒÓÍÛÏÂÌÚ ÌÂ Ì‡È‰ÂÌ',
    '—ÔËÒÓÍ ‰ÓÍÛÏÂÌÚÓ‚ ÔÛÒÚ',
    'ÕÂ ÏÓ„Û ‡ÒÔ‡ÍÓ‚‡Ú¸ Ù‡ÈÎ',
    'ÕÂ ÏÓ„Û Á‡Ô‡ÍÓ‚‡Ú¸ Ù‡ÈÎ',
    'ÕÂ‰ÓÔÛÒÚËÏ˚È ‰ÂÒÍËÔÚÓ (ÛÍ‡Á‡ÚÂÎ¸ Ì‡ CKeyDisk)',
    '—Ë„Ì‡ÚÛ‡ ÌÂ ‡‚Ì‡ ''CrYpT''',
    'ƒÓÔÛÒÚËÏÓ ÚÓÎ¸ÍÓ √Œ—“ ÍËÔÚÓ‚‡ÌËÂ',
    '‘‡ÈÎ ‡ÁÛ¯ÂÌ',
    'ÕÂËÁ‚ÂÒÚÌ˚È ÚËÔ ÔÓÎÛ˜‡ÚÂÎˇ',
    'ÕÂÚ ÔÓÎÛ˜‡ÚÂÎˇ',
    '›Ú‡ Ó·ÓÎÓ˜Í‡',
    'ÕÂ‚ÂÌ‡ˇ ‚ÂÒËˇ ÔÓÎÛ˜‡ÚÂÎˇ',
    'ŒÚÍÎÓÌÂÌÌ˚È ÔÓÎÛ˜‡ÚÂÎ¸ ‡‰ÂÒ‡',
    'ŒÚÍÎÓÌÂÌÌ˚È ÓÚÔ‡‚ËÚÂÎ¸ ‡‰ÂÒ‡ ',
    'ﬂ‚ÎˇÂÚÒˇ ‰ÎËÌÌ˚Ï ËÏÂÌÂÏ Í‡Ú‡ÎÓ„‡',
    'Exe-Ù‡ÈÎ ÔÓÎÛ˜‡ÂÚ ÌÂÔ‡‚ËÎ¸ÌÓÂ ˜ËÒÎÓ Ô‡‡ÏÂÚÓ‚',
    'Œ¯Ë·Ó˜Ì‡ˇ ·‡Á‡ ‰‡ÌÌ˚ı',
    '¡‡Á‡ ‰‡ÌÌ˚ı ÔÓÎÌ‡',
    '«‡ÔËÒ¸ ÌÂ Ì‡È‰ÂÌ‡',
    'ƒÓÍÛÏÂÌÚ ·˚Î Û‰‡ÎÂÌ',
    'ÕÂ‰ÓÔÛÒÚËÏ˚È ‡‰ÂÒ ÓÚÔ‡‚ËÚÂÎˇ',
    'ÕÂ‰ÓÔÛÒÚËÏ˚È ‡‰ÂÒ ÔÓÎÛ˜‡ÚÂÎˇ',
    'ƒÓÍÛÏÂÌÚ ÛÊÂ ÛÔ‡ÍÓ‚‡Ì',
    'ƒÓÍÛÏÂÌÚ ÌÂ Ì‡È‰ÂÌ',
    'Œ¯Ë·Í‡ ÔË Á‡ÔËÒË Ó·ÓÎÓ˜ÍË Á‡„ÓÎÓ‚Í‡',
    'Œ¯Ë·Í‡ ÔË ˜ÚÂÌËË Ó·ÓÎÓ˜ÍË Á‡„ÓÎÓ‚Í‡',
    'Œ¯Ë·Í‡ ÔË Û‰‡ÎÂÌËË Ó·ÓÎÓ˜ÍË Á‡„ÓÎÓ‚Í‡',
    'Œ¯Ë·Í‡ ¯ËÙÓ‚‡ÌËˇ Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ‰Â¯ËÙÓ‚‡ÌËˇ Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ËÏËÚÓ-Ù‡ÈÎ‡',
    '”Í‡Á‡ÌÌ˚È »ƒ≈Õ“»‘» ¿“Œ– ‡·ÓÌÂÌÚ‡ ËÎË ËÏˇ ÌÂ Ì‡È‰ÂÌ˚',
    'œÓ‰ÔËÒ¸ √Î‡‚ÌÓ„Ó ‡·ÓÌÂÌÚ‡ ‚ NNNN_SPR. sgn ÌÂÍÓÂÍÚÌ‡',
    '‘‡ÈÎ ËÎË Ô‡ÏˇÚ¸ ÛÊÂ ÔÓ‰ÔËÒ‡Ì˚ ÛÍ‡Á‡ÌÌ˚Ï ‡·ÓÌÂÌÚÓÏ',
    'Œ·ÓÎÓ˜Í‡ Ì‡ÁÌ‡˜ÂÌ‡ ‰Îˇ ‰Û„Ó„Ó ÔËÎÓÊÂÌËˇ',
    '«‡Ô‡¯Ë‚‡ÂÏ‡ˇ ‡·Ó˜‡ˇ „ÛÔÔ‡ ÓÚÒÛÚÒÚ‚Û˛ÂÚ ‚ ‡‰ÂÒÌÓÈ ÍÌË„Â',
    'Œ¯Ë·Í‡ ÓÚÍ˚ÚËˇ DB-Ú‡·ÎËˆ˚',
    'Œ¯Ë·Í‡ ˜ÚÂÌËˇ Ú‡·ÎËˆ˚ ˜ÚÓ·˚ ÔÂÂ˜ËÒÎËÚ¸',
    'Œ¯Ë·Í‡ ÏÓ‰ËÙËÍ‡ˆËË Á‡ÔËÒË DB-Ú‡·ÎËˆ˚',
    'œ‡‡ÏÂÚ˚ objects ‰Îˇ Ò‡‚ÌÂÌËˇ ÌÂ ÒÓ„Î‡ÒÓ‚‡Ì˚ ËÎË ÌÂ‚ÂÌ˚',
    'œ‡‚‡ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ ÌÂ ÔÓ‰ıÓ‰ˇÚ ‰Îˇ ÌÂÍÓÚÓÓÈ ÓÔÂ‡ˆËË',
    'ÕÂÍÓÚÓ˚È ËÌÚÂ‚‡Î ‚ÂÏÂÌË ÔÓÒÓ˜ÂÌ (ËÎË ÒÌˇÚ ËÁ ËÒÔÓÎ¸ÁÓ‚‡ÌËˇ)',
    'ÕÂÍÓÚÓ‡ˇ ÓÔÂ‡ˆËˇ ÌÂÔ‡‚ËÎ¸Ì‡',
    'œÂÂıÓ‰ Í ÒÎÂ‰Û˛˘ÂÏÛ ˝ÎÂÏÂÌÚÛ',
    'Œ¯Ë·Í‡ ˜ÚÂÌËˇ Á‡‰‡ÌÌÓ„Ó Ù‡ÈÎ‡',
    '◊ÚÂÌËÂ Ó¯Ë·Ó˜ÌÓ„Ó Á‡„ÓÎÓ‚Í‡ Ô‡ÍÂÚ‡',
    '◊ÚÂÌËÂ Ó¯Ë·Ó˜ÌÓ„Ó Á‡„ÓÎÓ‚Í‡ ‰ÓÍÛÏÂÌÚ‡',
    '◊ËÒÎÓ Ï‡ÒÚÂÓ‚  ÌÂ ÒÓ„Î‡ÒÓ‚‡ÌÓ',
    'ÕÂÚ ÌËÍ‡ÍËı Ï‡ÒÚÂÓ‚ ÒÂÚË ‰Îˇ ÔÓÓÊ‰ÂÌËˇ',
    '‘ÛÌÍˆËˇ ÌÂ ‚˚ÔÓÎÌÂÌ‡',
    ' ÓÌÂˆ ÔÓËÒÍ‡ Ù‡ÈÎÓ‚',
    '‘ÛÌÍˆËˇ ÌÂ ‚˚ÔÓÎÌÂÌ‡ ‚ ÌÂÍÓÚÓÓÏ ÒÎÛ˜‡Â',
    'CurPos() ÔÓÚÂÔÂÎ ÌÂÛ‰‡˜Û',
    'Truncate() ÔÓÚÂÔÂÎ ÌÂÛ‰‡˜Û',
    'Flush() ÔÓÚÂÔÂÎ ÌÂÛ‰‡˜Û',
    '‘‡ÈÎ ÛÊÂ ÒÛ˘ÂÒÚ‚ÛÂÚ',
    '”ÒÚ‡ÌÓ‚ËÚÂ ‚ÂÏˇ Ù‡ÈÎ‡',
    'œÓÎÛ˜ËÚÂ ‚ÂÏˇ Ù‡ÈÎ‡    ',
    'Œ¯Ë·Í‡ ÔÂÂÏÂ˘ÂÌËˇ ‘‡ÈÎ‡  ',
    '»ÒÔÓÎ¸ÁÛÈÚÂ GetLastError',
    'œÓÎÛ˜ËÚÂ ‰ËÒÍÓ‚Û˛ Ò‚Ó·Ó‰Û ËÎË Ó·˘ÂÂ',
    ' ÓÌÂˆ ÔÓÚÓÍ‡ ·˚Î ‰ÓÒÚË„ÌÛÚ',
    'ÕÛÊÂÌ ÔÂ‰‚‡ËÚÂÎ¸ÌÓ ÛÒÚ‡ÌÓ‚ÎÂÌÌ˚È ÒÎÓ‚‡¸',
    'Œ¯Ë·Í‡ ÔÓËÁÓ¯Î‡ ‚ Ù‡ÈÎÓ‚ÓÈ ÒËÒÚÂÏÂ, ¬˚ ÏÓÊÂÚÂ ÍÓÌÒÛÎ¸ÚËÓ‚‡Ú¸Òˇ Ò errno, ˜ÚÓ·˚ ÔÓÎÛ˜ËÚ¸ ÚÓ˜Ì˚È ÍÓ‰ Ó¯Ë·ÍË',
    '—ÓÒÚÓˇÌËÂ ÔÓÚÓÍ‡ ·˚ÎÓ ÌÂÒÓ„Î‡ÒÓ‚‡ÌÌÓ (Ì‡ÔËÏÂ, ÂÒÎË next_in ËÎË next_out ·˚Î Õ”À≈¬Œ… (œ”—“Œ…))',
    '¬ıÓ‰Ì˚Â ‰‡ÌÌ˚Â ·˚ÎË ‡ÁÛ¯ÂÌ˚',
    'ÕËÍ‡ÍÓÈ ÔÓ„ÂÒÒ ÌÂ ·˚Î ·˚ ‚ÓÁÏÓÊÂÌ ËÎË ÂÒÎË ÌÂ ËÏÂÎÓÒ¸ ‰ÓÒÚ‡ÚÓ˜ÌÓ„Ó Û˜‡ÒÚÍ‡ Ô‡ÏˇÚË ‚ ·ÛÙÂÂ ‚˚‚Ó‰‡',
    '¡Ë·ÎËÓÚÂ˜Ì‡ˇ ‚ÂÒËˇ ÌÂÒÓ‚ÏÂÒÚËÏ‡ Ò ‚ÂÒËÂÈ ÔËÌˇÚÓ„Ó Í ‚˚Á˚‚‡˛˘ÂÏÛ ÓÔÂ‡ÚÓÛ',
    'ÕÂÔÂ‰‚Ë‰ÂÌÌ‡ˇ Ù‡ÈÎÓ‚‡ˇ ÒÚÛÍÚÛ‡',
    '—ÂÚÂ‚ÓÈ ÌÓÏÂ ÌÂÔ‡‚ËÎÂÌ',
    '¬ÂÒËˇ ÌÂÔ‡‚ËÎ¸Ì‡',
    'ÕÓÏÂ Á‡‰‡˜Ë ÌÂÔ‡‚ËÎÂÌ',
    '√Î‡‚Ì˚È ‡·ÓÌÂÌÚ ÌÂ Ì‡È‰ÂÌ ‚ NNNN.CHF',
    'WS ÌÂ Á‡Â„ËÒÚËÓ‚‡Ì ‰Îˇ ˝ÚÓÈ Á‡‰‡˜Ë',
    'ƒÓÍÛÏÂÌÚ ÌÂ ÔÓ‰ÔËÒ‡Ì',
    'Œ¯Ë·Í‡ ‚Ó ‚ÂÏˇ ÔÓ‚ÂÍË ÔÓ‰ÔËÒË',
    '◊ÚÓ-ÚÓ ÌÂ ÛÒÚ‡ÌÓ‚ÎÂÌÓ',
    'ÕÂÍÓÚÓ‡ˇ ÓÔÂ‡ˆËˇ ÛÊÂ ‚˚ÔÓÎÌˇÂÚÒˇ',
    'ƒËÒÍÓ‚Ó‰ ÌÂ „ÓÚÓ‚',
    ' ÓÌÙÎËÍÚ ‚ ÔÓÔ˚ÚÍÂ ÍÓÔËÓ‚‡Ú¸ Ù‡ÈÎ˚ Ò ÒÓÁ‰‡ÌËÂÏ ‚ÂÏÂÌË ÏÂÌ¸¯Â ÒÛ˘ÂÒÚ‚Û˛˘Â„Ó',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ LoadLibrary',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ GetProcAddress',
    'ŒÔÂ‡ˆËˇ ·˚Î‡ ÓÚÏÂÌÂÌ‡ ÔÓÎ¸ÁÓ‚‡ÚÂÎÂÏ',
    'œÂÊ‰Â‚ÂÏÂÌÌ‡ˇ ÓÔÂ‡ˆËˇ, ÔÓ‚Â¸ÚÂ ¬‡¯Â ‚ÂÏˇ ÒËÒÚÂÏ˚, ÔÓÊ‡ÎÛÈÒÚ‡',
    '”ÒÚ‡ÌÓ‚ÍË ÌÂÔ‡‚ËÎ¸Ì˚',
    '«‡¯ËÙÓ‚‡ÌÓ ‰Û„ËÏ ser',
    '«‡¯ËÙÓ‚‡ÌÓ ‰Û„ËÏ Ô‡ÓÎÂÏ ser',
    '«‡¯ËÙÓ‚‡ÌÓ ˝ÚËÏ Ô‡ÓÎÂÏ ser',
    'ÕÂ Á‡¯ËÙÓ‚‡ÌÓ',
    '«‡¯ËÙÓ‚‡ÌÓ ‚ ‰Û„ÓÏ ÂÊËÏÂ',
    'ŒÔÂ‡ˆËˇ ÌÂ ÏÓÊÂÚ ·˚Ú¸ ‚˚ÔÓÎÌÂÌ‡',
    '»ƒ≈Õ“»‘» ¿“Œ–€ ÒÓ‚Ô‡‰‡˛Ú (ËÎË ˜ÚÓ-ÌË·Û‰¸ Â˘Â)',
    '»ƒ≈Õ“»‘» ¿“Œ–€ ÌÂ ÒÓ‚Ô‡‰‡˛Ú (ËÎË ˜ÚÓ-ÌË·Û‰¸ Â˘Â)',
    'ÕÂ Ó¯Ë·Í‡, ÌÓ Œ“Ã≈Õ¿ ÒÚ‡ÎÍË‚‡ÎËÒ¸ Ò ÔË˜ËÌÓÈ ÌÂÍÓÚÓÓÈ Ó¯Ë·ÍË ËÎË ÓÚÏÂÌ˚ ·˚Ú¸ ÔÓÎ¸ÁÓ‚‡ÚÂÎ¸',
    '“‡ÌÒÔÓÚÌÓÂ ÔÓÎÛ˜ÂÌËÂ ÌÂ ‰ÓÔÛÒÍ‡ÂÚ ÒÓÒÚÓˇÌËÂ',
    'ƒÛ„ÓÈ ËÏËÚÓ-ÍÎ˛˜',
    'ƒÛ„ÓÈ ËÏËÚÓ-Á‡„ÓÎÓ‚ÓÍ',
    'Deimito Ó¯Ë·Í‡ Ù‡ÈÎ‡',
    'œËÎÓÊÂÌËÂ Á‡·ÎÓÍËÓ‚‡ÌÓ',
    'IP-Ú‡ÙÙËÍ ·˚ÎÓ ·ÎÓÍËÓ‚‡ÌÓ', '', '', '', '',
    'Œ¯Ë·Ó˜Ì˚È ‡‰ÂÒ ÙÛÌÍˆËË Ó·‡ÚÌÓ„Ó ‚˚ÁÓ‚‡',
    'ÕÂ‰ÓÔÛÒÚËÏ˚È ÍÓ‰ ÛÒÚÓÈÒÚ‚‡',
    'ŒÊË‰‡ÌËÂ ÛÒÚÓÈÒÚ‚‡ ÔÂ‚‡ÌÓ',
    'Œ¯Ë·Í‡ ÒÓÁ‰‡ÌËˇ Ó·˙ÂÍÚ‡ ÛÒÚÓÈÒÚ‚‡',
    'ƒ‡È‚Â ËÎË ÛÒÚÓÈÒÚ‚Ó ÌÂ ÛÒÚ‡ÌÓ‚ÎÂÌ˚',
    'Œ¯Ë·Í‡ ˜ÚÂÌËˇ Ë‰ÂÌÚËÙËÍ‡ÚÓ‡ ÍÎ˛˜‡',
    'ÕÂÔ‡‚ËÎ¸Ì˚È ÒÎÓÚ ÛÒÚÓÈÒÚ‚‡',
    'ÕÂÓÔÂ‰ÂÎÂÌÌ‡ˇ ÙÛÌÍˆËˇ',
    ' Î˛˜ ÌÂ ‚ÒÚ‡‚ÎÂÌ ‚ ÛÒÚÓÈÒÚ‚Ó',
    'Œ¯Ë·Í‡ ˜ÚÂÌËˇ Ò ÛÒÚÓÈÒÚ‚‡',
    'Œ¯Ë·Í‡ Á‡ÔËÒË Ì‡ ÛÒÚÓÈÒÚ‚Ó',
    'Œ¯Ë·Í‡ lentgh ˜ÚÂÌËˇ ËÎË Á‡ÔËÒË',
    'Œ¯Ë·Ó˜Ì˚Â ‰‡ÌÌ˚Â „Î‡‚ÌÓÈ ÔÓ‰ÔËÒË',
    'ÕÂÔ‡‚ËÎ¸ÌÓÂ ËÏˇ Ù‡ÈÎ‡',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ RegOpenKey',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ RegQueryValueEx',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ SwitchDesktop',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ SystemParametersInfo',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ CreateWindowEx',
    '–‡Á·ÎÓÍËÓ‚Í‡ ÌÂ‚ÓÁÏÓÊÌ‡ - Á‡˘ÂÎÍ‡ Á‡ÌˇÚ‡',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ CreateDesktop',
    'Œ¯Ë·Í‡ ‚ ÚÂ˜ÂÌËÂ CreateThread',
    'œÓÎ¸ÁÓ‚‡ÚÂÎ¸ ÌÂ ËÏÂÂÚ Ô‡‚‡ ÔÓ‰ÔËÒ˚‚‡Ú¸',
    'œÓÎ¸ÁÓ‚‡ÚÂÎ¸ ·˚Î Û‰‡ÎÂÌ ËÁ VPN',
    'ŒÚÒÛÚÒÚ‚ËÂ (ÔÓËÁ‚ÓÎ¸ÌÓ„Ó) Ó·˙ÂÍÚ‡',
    '(œÓËÁ‚ÓÎ¸Ì˚È) Ó·˙ÂÍÚ ÛÊÂ ÒÛ˘ÂÒÚ‚ÛÂÚ',
    'ŒÚÒÛÚÒÚ‚ÛÂÚ Ù‡ÈÎ ÔËÒÓÂ‰ËÌÂÌËˇ',
    '–‡ÁÏÂ ÔÓ˜Ú˚ ‚ÌÂ ‡ÁÏÂ‡ Ò ‰ÓÔÛÒÍÓÏ Ô‡ÏˇÚË ÒÓÓ·˘ÂÌËˇ',
    'Œ¯Ë·Í‡ ‚ ÙÛÌÍˆËË Ó·‡·ÓÚÍË ‡Î¸ÚÂÌ‡ÚË‚ÌÓ„Ó ı‡ÌÂÌËˇ ‰‡ÌÌ˚ı ÛÒÚÓÈÒÚ‚',
    '—Óı‡ÌËÚÂ CSP ÍÎ˛˜ Á‡˘ËÚ˚ ‚ Â„ËÒÚ',
    '√Î‡‚Ì˚È ‡·ÓÌÂÌÚ ÔÓ·ÛÂÚ ÒÓÁ‰‡Ú¸ ÌÓ‚Û˛ ˆËÙÓ‚Û˛ ÒË„Ì‡ÚÛÛ Ì‡ ¿√≈Õ“—“¬≈ ¿œ',
    '¿·ÓÌÂÌÚ ÔÓ·ÛÂÚ ÒÓÁ‰‡Ú¸ ÌÓ‚Û˛ ˆËÙÓ‚Û˛ ÒË„Ì‡ÚÛÛ Ì‡ ÌÂ ÔÂ‚Ë˜ÌÓÏ ¿√≈Õ“—“¬≈ ¿œ',
    '«‡Ô‡¯Ë‚‡ÂÏ˚È ÒÂÚËÙËÍ‡Ú ÌÂ‰ÂÈÒÚ‚ËÚÂÎÂÌ.'#13#10'—ËÒÚÂÏÌ‡ˇ ‰‡Ú‡ ‚ÌÂ ‰Ë‡Ô‡ÁÓÌ‡ ‰ÂÈÒÚ‚Ëˇ ÒÂÚËÙËÍ‡Ú‡',
    '«‡Ô‡¯Ë‚‡ÂÏ˚È ÒÂÚËÙËÍ‡Ú ÌÂ ‰ÂÈÒÚ‚ÛÂÚ ‚ ÛÍ‡Á‡ÌÌÓÏ ÔÂËÓ‰Â',
    '“ÂÍÛ˘ÂÂ Û‰ÓÒÚÓ‚ÂÂÌËÂ ÔÓ‰ÔËÒË ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ ÌÂÒÓ‚ÏÂÒÚËÏÓ Ò ÙÓÏ‡ÚÓÏ ÔÓ‰ÔËÒ‡ÌÌÓ„Ó Ù‡ÈÎ‡'
   );

function ErrToStr(Err: Integer): string;
begin
  if (0<=Err) and (Err<=204) then
    Result := ExtErrMesRus[Err]+#13#10+ExtErrMes[Err]+' ('+IntToStr(Err)+')'
  else
    Result := 'Unknown error'#13#10'ÕÂËÁ‚ÂÒÚÌ‡ˇ Ó¯Ë·Í‡ ('+IntToStr(Err)+')'
end;

function GetSignIssuerName(const pEncodedCertificate: Pointer;
  const EncodedCertSize: dWord; var pSignInfo: PChar; var pSignInfoLen: dWord): Boolean;
var
  dwCertSize: dWord;        // ƒÎËÌ‡ ‡ÒÍÓ‰ËÓ‚‡ÌÌÓ„Ó ÒÂÚËÙËÍ‡Ú‡
  dwCertInfoSize: dWord;    // ƒÎËÌ‡ ‡ÒÍÓ‰ËÓ‚‡ÌÌÓÈ ËÌÙÓÏ‡ˆËË Ó ÒÂÚËÙËÍ‡ÚÂ
  dwNameSize: dWord;        // ƒÎËÌ‡ ÒÚÓÍË Ò ËÏÂÌÂÏ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ
  pSignedCertInfo: PCERT_SIGNED_CONTENT_INFO;  // ”Í‡Á‡ÚÂÎ¸ Ì‡ ‡ÒÍÓ‰ËÓ‚‡ÌÌ˚È ÒÂÚËÙËÍ‡Ú
  pCertInfo: PCERT_INFO;      // ”Í‡Á‡ÚÂÎ¸ Ì‡ ‡ÒÍÓ‰ËÓ‚‡ÌÌÛ˛ ËÌÙÓÏ‡ˆË˛ Ó ÒÂÚËÙËÍ‡ÚÂ
  pSubjectName: PChar;   // ”Í‡Á‡ÚÂÎ¸ Ì‡ ËÏˇ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ
begin
  Result := False;
  dwCertSize := 0;
  dwCertInfoSize := 0;
  dwNameSize := 0;
  pSignedCertInfo := nil;
  pCertInfo := nil;
  pSubjectName := nil;
  pSignInfoLen := 0;
  //* ƒÂÍÓ‰ËÛÂÏ Á‡ÍÓ‰ËÓ‚‡ÌÌ˚È ÒÂÚËÙËÍ‡Ú */
  if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
    X509_CERT, pEncodedCertificate,
    EncodedCertSize, 0, nil, @dwCertSize) then
  begin
    pSignedCertInfo := AllocMem(dwCertSize);
    try
      if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
        X509_CERT, pEncodedCertificate,
        EncodedCertSize, 0, pSignedCertInfo, @dwCertSize) then
      begin
        //* ƒÂÍÓ‰ËÛÂÏ Á‡ÍÓ‰ËÓ‚‡ÌÌ˚È CERT_INFO */
        if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
          X509_CERT_TO_BE_SIGNED,
          pEncodedCertificate,
          EncodedCertSize, 0, nil, @dwCertInfoSize) then
        begin
          pCertInfo := AllocMem(dwCertInfoSize);
          try
            if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
              X509_CERT_TO_BE_SIGNED,
              pEncodedCertificate,
              EncodedCertSize, 0, pCertInfo, @dwCertInfoSize) then
            begin
              //* ƒÂÍÓ‰ËÛÂÏ Á‡ÍÓ‰ËÓ‚‡ÌÌÓÂ ËÏˇ ÔÓ‰ÔËÒ‡‚¯Â„Ó */
              dwNameSize := CertNameToStr(
                X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
                @pCertInfo.Subject, CERT_X500_NAME_STR, //* ¬ ‰‡ÌÌÓÏ ÒÎÛ˜‡Â ‚ÓÁ‚‡˘‡ÂÏ ÔÓÎÌÓÂ ËÏˇ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ (‚ÒÂ, ˜ÚÓ Á‡ÔËÒ‡ÌÓ) Ó‰ÌÓÈ ÒÚÓÍÂ */
                nil, 0);
              if dwNameSize>0 then
              begin
                pSubjectName := AllocMem(dwNameSize);
                try
                  dwNameSize := CertNameToStr(
                    X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
                    @pCertInfo.Subject,
                    CERT_X500_NAME_STR,
                    pSubjectName, dwNameSize);
                  if dwNameSize>0 then
                  begin
                    //* ‡ÎÓÍËÛÂÏ Ô‡ÏˇÚ¸ Ë Á‡ÔËÒ˚‚‡ÂÏ ËÏˇ ÔÓÎ¸ÁÓ‚‡ÚÂÎˇ */
                    pSignInfo := AllocMem(dwNameSize);
                    pSignInfoLen := dwNameSize;
                    Move(pSubjectName^, pSignInfo^, pSignInfoLen);
                    Result := True;
                  end;
                finally
                  FreeMem(pSubjectName);
                end;
              end;
            end;
          finally
            FreeMem(pCertInfo);
          end;
        end;
      end;
    finally
      FreeMem(pSignedCertInfo);
    end;
  end;
end;

function GetSignTime(const pEncodedSignerInfo: Pointer;
  const EncodedSignerInfoSize: dWord; var ATime: TDateTime): Boolean;
var
  dwSignerInfoSize, dwSignTimeSize, index: dWord;
  pMessageSignerInfo: PCMSG_SIGNER_INFO;
  DecodedFTime: FILETIME;
  pSignTime: SYSTEMTIME;
begin
  Result := False;
  dwSignerInfoSize := 0;
  dwSignTimeSize := 0;
  pMessageSignerInfo := nil;
  index := 0;
  //* ƒÂÍÓ‰ËÛÂÏ Á‡ÍÓ‰ËÓ‚‡ÌÌÛ˛ ÒÚÛÍÚÛÛ */
  if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
    PKCS7_SIGNER_INFO,
    pEncodedSignerInfo,
    EncodedSignerInfoSize, 0,
    nil, @dwSignerInfoSize) then
  begin
    //showmessage('1='+inttostr(dwSignerInfoSize));
    pMessageSignerInfo := AllocMem(dwSignerInfoSize);
    try
      if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
        PKCS7_SIGNER_INFO,
        pEncodedSignerInfo,
        EncodedSignerInfoSize, 0,
        pMessageSignerInfo, @dwSignerInfoSize) then
      begin
        //* ¬ CMSG_SIGNER_INFO ‰‡Ú‡/‚ÂÏˇ ÔÓ‰ÔËÒË Ì‡ıÓ‰ËÚÒˇ ‚ ÍÓ‰ËÓ‚‡ÌÌÓÏ ‚Ë‰Â */
        //* ƒÂÍÓ‰ËÛÂÏ Á‡ÍÓ‰ËÓ‚‡ÌÌÓÂ ËÏˇ ÔÓ‰ÔËÒ‡‚¯Â„Ó                          */
        //showmessage('2='+inttostr(dwSignerInfoSize));
        index := 0;
        while index<pMessageSignerInfo.AuthAttrs.cAttr do
        begin
          //showmessage('3='+inttostr(index)+' ËÁ '+inttostr(pMessageSignerInfo.AuthAttrs.cAttr));
          if StrLComp(szOID_RSA_signingTime,
            (pMessageSignerInfo.AuthAttrs.rgAttr[index]).pszObjId,
            StrLen(szOID_RSA_signingTime))=0 then
          begin
            //showmessage('4='+inttostr(index));
            //* Õ‡¯ÎË ÌÛÊÌ˚È ‡ÚË·ÛÚ. */
            //* ’ÓÚˇ ‚ Ó·˘ÂÏ ÒÎÛ˜‡Â ‚ ‡ÚË·ÛÚÂ ÏÓÊÂÚ ·˚Ú¸ ÌÂÒÍÓÎ¸ÍÓ */
            //* ÁÌ‡˜ÂÌËÈ, ‰Îˇ ¬ÂÏÂÌË œÓ‰ÔËÒË ËÒÔÓÎ¸ÁÛÂÚÒˇ Ó‰ËÌ,    */
            //* ÔÓ˝ÚÓÏÛ ‚˚·ÂÂÏ ÔÂ‚˚È Ë ‡ÒÍÓ‰ËÛÂÏ ¬ÂÏˇ œÓ‰ÔËÒË. */
            if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
              PKCS_UTC_TIME,
              (pMessageSignerInfo.AuthAttrs.rgAttr[index]).rgValue.pbData,
              (pMessageSignerInfo.AuthAttrs.rgAttr[index]).rgValue.cbData,
              0, nil, @dwSignTimeSize) then
            begin
              //showmessage('5='+inttostr(dwSignTimeSize));
              if CryptDecodeObject(X509_ASN_ENCODING or PKCS_7_ASN_ENCODING,
                PKCS_UTC_TIME,
                (pMessageSignerInfo.AuthAttrs.rgAttr[index]).rgValue.pbData,
                (pMessageSignerInfo.AuthAttrs.rgAttr[index]).rgValue.cbData,
                0, @DecodedFTime, @dwSignTimeSize) then
              begin
                //showmessage('6='+inttostr(dwSignTimeSize));
                if FileTimeToLocalFileTime(DecodedFTime, DecodedFTime) then
                  if FileTimeToSystemTime(DecodedFTime, pSignTime) then
                  begin
                    Result := True;
                    ATime := SystemTimeToDateTime(pSignTime);
                    //showmessage('7=!!!');
                  end;
              end;
            end;
            index := pMessageSignerInfo.AuthAttrs.cAttr;
          end;
          Inc(index);
        end;
      end;
    finally
      FreeMem(pMessageSignerInfo)
    end;
  end;
end;

var
  UserList: TStringList = nil;

function InitUserNameList(fc: PEXT_FULL_CONTEXT;
  GetMes: Boolean; var Mes: string): Boolean;
var
  UserIdList: PChar;
  UserIDListSize: Integer;
  UserID: array[0..9] of Char;
  UserNick: array[0..91] of Char;
  UserName: array[0..71] of Char;
  I, J, ID, Err: Integer;
begin
  DoneUserNameList;
  Result := False;
  try
    UserIDList := nil;
    UserIDListSize := 0;
    if TExtGetUserIDList(GetExtPtr(fiGetUserIDList))(fc, UserIDList, UserIDListSize)=0 then
    begin
      //messagebox(0, PChar('size list!!!'+IntToStr(UserIDListSize)+']'), 'zzz', 0);
      UserList := TStringList.Create;
      Err := 0;
      I := 0;
      J := StrLen(UserIDList);
      while (Err=0) and (I+J<UserIDListSize) do
      begin
        if J>0 then
        begin
          StrLCopy(@UserID, @UserIDList[I], SizeOf(UserID)-1);
          Err := TExtGetUserAlias(GetExtPtr(fiGetUserAlias))(fc, UserID, UserNick, UserName);
          if Err=0 then
          begin
            StrUpper(@UserID);
            Val('$'+UserID, ID, Err);
            if Err=0 then
            begin
              StrUpper(@UserName);
              //messagebox(0, PChar('['+UserName+']'+Dec2Hex(ID,8)), 'zzz', 0);
              UserList.AddObject(UserName, TObject(ID))
            end
            else
              if GetMes then
                Mes := 'Œ¯Ë·Í‡ ÓˆËÙÂÌËˇ $'+UserID;
          end
          else
            if GetMes then
              Mes := 'Œ¯Ë·Í‡ ÔÓËÒÍ‡ ËÏÂÌË '+UserID+' Err='+ErrToStr(Err);
        end;
        I := I+J+1;
        J := StrLen(@UserIDList[I]);
      end;
      Result := True;
    end
    else
      if GetMes then
        Mes := 'Œ¯Ë·Í‡ ‚ÁˇÚËˇ ÒÔËÒÍ‡ ExtGetUserIDList '+ErrToStr(Err);
  finally
    if UserIDList<>nil then
      TExtFreeMemory(GetExtPtr(fiFreeMemory))(UserIDList, UserIDListSize);
  end;
end;

procedure DoneUserNameList;
begin
  if UserList<>nil then
  begin
    UserList.Free;
    UserList := nil;
  end;
end;

function GetUserIdByName(pContext: PEXT_FULL_CONTEXT; const AName: string): string;
var
  I: Integer;
  UserID: array[0..9] of Char;
  UserNick: array[0..91] of Char;
  UserName: array[0..71] of Char;
begin
  Result := '';
  if pContext<>nil then
  begin
    StrPLCopy(UserNick, AName, SizeOf(UserNick)-1);
    if TExtGetUserID(GetExtPtr(fiGetUserID))(pContext, UserNick, UserID, UserName)=e_NO_ERROR then
      Result := UpperCase(Trim(UserID))
  end;
  if Length(Result)=0 then
  begin
    //messagebox(0, '11', '22', 0);
    if UserList<>nil then
    begin
      I := UserList.IndexOf(UpperCase(Trim(AName)));
      //messagebox(0, PChar('a!!!'+AName+'='+IntToStr(I)+']'), 'zzz', 0);
      if I>=0 then
        Result := Dec2Hex(Integer(UserList.Objects[I]), 8);
        //Format('%x',[Integer(UserList.Objects[I])]);
    end;
  end;
  //messagebox(0, '11', PChar('!!!!!!! ['+Result+']'), 0);
end;

var
  ItcsMainLib: HModule = 0;

function LoadItscLib(var Mes: string): Boolean;
var
  I: Integer;
  P: Pointer;
begin
  Result := ItcsMainLib<>0;
  if not Result then
  begin
    ItcsMainLib := LoadLibrary(Tcc_Itcs_Dll);
    if ItcsMainLib=0 then
      Mes := 'Œ¯Ë·Í‡ ÔÓ‰ÍÎ˛˜ÂÌËˇ ÏÓ‰ÛÎˇ '+Tcc_Itcs_Dll+' LastErr='
        +IntToStr(GetLastError)
    else begin
      Result := True;
      Mes := '';
      for I := Low(FuncList) to High(FuncList) do
      begin
        P := GetProcAddress(ItcsMainLib, FuncList[I].flDllName);
        FuncList[I].flPtr := P;
        if P=nil then
          Mes := #13#10+FuncList[I].flDllName;
      end;
      if Length(Mes)>0 then
        Mes := 'ÕÂ Û‰‡ÎÓÒ¸ Á‡„ÛÁËÚ¸ ÙÛÌÍˆËË:'+Mes+#13#10'ËÁ ÏÓ‰ÛÎˇ '
          +Tcc_Itcs_Dll;
    end;
  end;
end;

function IsItscLibLoaded: Boolean;
begin
  Result := ItcsMainLib<>0;
end;

function GetExtPtr(FuncIndex: Integer): Pointer;
begin
  if IsItscLibLoaded then
  begin
    Result := FuncList[FuncIndex].flPtr;
    if Result=nil then
      MessageBox(0, PChar('‘ÛÌÍˆËˇ ÌÂ ÔÓËÌËˆË‡ÎËÁËÓ‚‡Ì‡ ['
        +FuncList[FuncIndex].flDllName+']'), '«‡ÔÓÒ ÛÍ‡Á‡ÚÂÎˇ ÙÛÌÍˆËË',
        MB_OK or MB_ICONERROR);
  end
  else
    MessageBox(0, PChar('ÃÓ‰ÛÎ¸ — «» ÌÂ Á‡„ÛÊÂÌ ['
      +FuncList[FuncIndex].flDllName+']'), '«‡ÔÓÒ ÛÍ‡Á‡ÚÂÎˇ ÙÛÌÍˆËË',
      MB_OK or MB_ICONERROR);
end;

procedure FreeItscLib;
begin
  if IsItscLibLoaded then
  begin
    FreeLibrary(ItcsMainLib);
    ItcsMainLib := 0;
  end;
end;

end.

